<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì•„ëì–´ ììŒ Â· ëª¨ìŒ Â· ë‹¨ì–´ Â· ë¬¸ì¥ í•„ê¸° ì—°ìŠµ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&family=Scheherazade+New:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Noto Sans KR", system-ui, -apple-system, BlinkMacSystemFont,
        "Segoe UI", sans-serif;
      background: #f3f4f6;
      color: #111827;
    }

    .app {
      max-width: 1400px;
      margin: 0 auto;
      padding: 8px 12px 40px;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 12px;
      margin-bottom: 8px;
    }

    .logo-title {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 700;
      font-size: 1.1rem;
    }

    .logo-dot {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      background: linear-gradient(135deg, #2563eb, #0ea5e9);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 0.8rem;
      box-shadow: 0 4px 10px rgba(37, 99, 235, 0.4);
    }

    .nav-tabs {
      display: flex;
      gap: 4px;
    }

    .nav-tab {
      border: none;
      background: transparent;
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 0.85rem;
      cursor: pointer;
      color: #6b7280;
    }

    .nav-tab.active {
      background: #111827;
      color: #f9fafb;
    }

    .app-main {
      display: grid;
      grid-template-columns: 280px 1fr;
      gap: 8px;
      align-items: stretch;
    }

    .side-panel {
      background: #ffffff;
      border-radius: 14px;
      padding: 10px 10px 12px;
      box-shadow: 0 8px 20px rgba(15, 23, 42, 0.06);
      display: flex;
      flex-direction: column;
      min-height: 520px;
      max-height: 620px;
    }

    .hidden {
      display: none !important;
    }

    .panel-title {
      font-weight: 600;
      font-size: 0.95rem;
      margin-bottom: 6px;
    }

    .sub-text {
      font-size: 0.75rem;
      color: #6b7280;
      margin-bottom: 8px;
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-bottom: 10px;
    }

    .chip {
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 0.7rem;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      color: #4b5563;
      cursor: pointer;
    }

    .chip.active {
      background: #111827;
      color: #f9fafb;
      border-color: #111827;
    }

    .list-scroll {
      flex: 1;
      overflow-y: auto;
      padding-right: 2px;
      margin-right: -4px;
    }

    .list-item {
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      background: #ffffff;
      padding: 6px 8px;
      margin-bottom: 6px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 2px;
      transition: background 0.12s ease, transform 0.08s ease, box-shadow 0.12s;
    }

    .list-item:hover {
      background: #f3f4ff;
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(148, 163, 184, 0.35);
    }

    .list-item-title {
      display: flex;
      justify-content: space-between;
      width: 100%;
      align-items: center;
    }

    .list-arabic {
      font-family: "Scheherazade New", "Amiri", serif;
      font-size: 1.35rem;
      direction: rtl;
    }

    .list-korean {
      font-size: 0.8rem;
      color: #374151;
    }

    .list-extra {
      font-size: 0.7rem;
      color: #6b7280;
    }

    /* ììŒ ì¹´ë“œìš© í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
    .letter-card-letter {
      font-family: "Scheherazade New", "Amiri", serif;
      font-size: 1.4rem;
      margin-bottom: 2px;
      direction: rtl;
      width: 100%;
      text-align: center;
    }

    .letter-card-sub {
      font-size: 0.65rem;
      color: #4b5563;
      line-height: 1.15;
      width: 100%;
      text-align: center;
    }

    .side-section-title {
      font-size: 0.78rem;
      font-weight: 600;
      margin: 6px 0 4px;
    }

    .side-form {
      border-radius: 12px;
      border: 1px dashed #e5e7eb;
      padding: 8px;
      margin-top: 6px;
    }

    .side-form input {
      width: 100%;
      margin-bottom: 4px;
      padding: 5px 7px;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
      font-size: 0.78rem;
    }

    .side-form button {
      width: 100%;
      padding: 6px;
      border-radius: 999px;
      border: none;
      background: #111827;
      color: #f9fafb;
      font-size: 0.8rem;
      cursor: pointer;
    }

    /* ì˜¤ë¥¸ìª½ ì˜ì—­ */

    .practice {
      background: #ffffff;
      border-radius: 14px;
      padding: 10px 10px 14px;
      box-shadow: 0 8px 20px rgba(15, 23, 42, 0.06);
      min-height: 520px;
      max-height: 620px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .sentence-card {
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      padding: 8px 10px;
      background: #f9fafb;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .sentence-row {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      align-items: center;
    }

    .sentence-ar {
      font-family: "Scheherazade New", "Amiri", serif;
      font-size: 1.4rem;
      direction: rtl;
      text-align: right;
      flex: 1;
      padding-left: 4px;
    }

    .sentence-ko {
      font-size: 0.8rem;
      color: #4b5563;
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 2px;
    }

    .btn-sm {
      border-radius: 999px;
      border: 1px solid #d1d5db;
      padding: 3px 8px;
      background: #fff;
      font-size: 0.75rem;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      cursor: pointer;
    }

    .btn-sm span {
      font-size: 0.9em;
    }

    .preview-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }

    .current-label {
      font-size: 0.8rem;
      color: #4b5563;
      padding: 5px 10px;
      border-radius: 999px;
      background: #f3f4f6;
      border: 1px solid #e5e7eb;
      white-space: nowrap;
      max-width: 60%;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .preview-box {
      min-width: 90px;
      max-width: 170px;
      padding: 4px 8px;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .preview-text {
      font-family: "Scheherazade New", "Amiri", serif;
      font-size: 2.1rem;
      direction: rtl;
      text-align: center;
      width: 100%;
      white-space: nowrap;
    }

    .canvas-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      flex: 1;
      min-height: 0;
    }

    .canvas-card {
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      padding: 6px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      background: #f9fafb;
      min-height: 0;
    }

    .canvas-title-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.8rem;
      color: #4b5563;
    }

    .canvas-controls {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.75rem;
      color: #6b7280;
    }

    .canvas-controls input[type="range"] {
      width: 80px;
    }

    .canvas-controls button {
      border-radius: 999px;
      border: 1px solid #d1d5db;
      padding: 2px 8px;
      background: #ffffff;
      cursor: pointer;
      font-size: 0.72rem;
    }

    canvas {
      flex: 1;
      border-radius: 10px;
      background: #ffffff;
      border: 1px dashed #e5e7eb;
      touch-action: none;
    }

    .record-panel {
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      padding: 6px 8px;
      background: #f9fafb;
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 0.8rem;
    }

    .record-row {
      display: flex;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
    }

    .record-status {
      font-size: 0.75rem;
      color: #6b7280;
    }

    .btn-rec {
      border-radius: 999px;
      border: none;
      padding: 4px 10px;
      font-size: 0.78rem;
      cursor: pointer;
      color: white;
      background: #ef4444;
    }

    .btn-stop {
      border-radius: 999px;
      border: none;
      padding: 4px 10px;
      font-size: 0.78rem;
      cursor: pointer;
      color: #111827;
      background: #e5e7eb;
    }

    audio {
      width: 160px;
    }

    .sent-list {
      flex: 1;
      overflow-y: auto;
      padding-right: 2px;
      margin-right: -4px;
      margin-top: 4px;
    }

    .sent-item {
      border-radius: 10px;
      border: 1px solid #e5e7eb;
      padding: 6px 8px;
      margin-bottom: 4px;
      cursor: pointer;
      background: #ffffff;
      display: flex;
      flex-direction: column;
      gap: 2px;
      transition: background 0.1s ease, transform 0.08s ease,
        box-shadow 0.12s ease;
    }

    .sent-item:hover {
      background: #eef2ff;
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(148, 163, 184, 0.4);
    }

    .sent-ar-list {
      font-family: "Scheherazade New", "Amiri", serif;
      font-size: 1.15rem;
      direction: rtl;
      text-align: right;
    }

    .sent-ko-list {
      font-size: 0.75rem;
      color: #4b5563;
    }

    @media (max-width: 900px) {
      .app-main {
        grid-template-columns: 1fr;
      }

      .side-panel {
        order: 2;
        max-height: 280px;
      }

      .practice {
        order: 1;
        max-height: none;
      }

      .canvas-row {
        grid-template-columns: 1fr;
      }

      .preview-text {
        font-size: 1.8rem;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="logo-title">
        <div class="logo-dot">AR</div>
        <span>Arabic Practice Lab</span>
      </div>
      <div class="nav-tabs">
        <button class="nav-tab active" data-tab="letters" onclick="setTab('letters')">ììŒ</button>
        <button class="nav-tab" data-tab="vowels" onclick="setTab('vowels')">ëª¨ìŒ</button>
        <button class="nav-tab" data-tab="words" onclick="setTab('words')">ë‹¨ì–´</button>
        <button class="nav-tab" data-tab="sentences" onclick="setTab('sentences')">ë¬¸ì¥</button>
      </div>
    </header>

    <main class="app-main">
      <!-- ì™¼ìª½ íŒ¨ë„: ììŒ -->
      <aside id="panel-letters" class="side-panel">
        <div class="panel-title">ììŒ ì—°ìŠµ</div>
        <div class="sub-text">ììŒì„ ëˆŒëŸ¬ ë°œìŒê³¼ ëª¨ì–‘ì„ ë³´ê³  ë”°ë¼ ì¨ ë³´ì„¸ìš”.</div>
        <div id="lettersList" class="list-scroll"></div>
      </aside>

      <!-- ì™¼ìª½ íŒ¨ë„: ëª¨ìŒ -->
      <aside id="panel-vowels" class="side-panel hidden">
        <div class="panel-title">ëª¨ìŒ ì—°ìŠµ</div>
        <div class="sub-text">ì§§ì€ ëª¨ìŒ / ê¸´ ëª¨ìŒì„ ë³´ê³  ë°œìŒì„ ìµí˜€ ë³´ì„¸ìš”.</div>
        <div id="vowelsList" class="list-scroll"></div>
      </aside>

      <!-- ì™¼ìª½ íŒ¨ë„: ë‹¨ì–´ -->
      <aside id="panel-words" class="side-panel hidden">
        <div class="panel-title">ë‹¨ì–´ ì—°ìŠµ</div>
        <div class="sub-text">ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ê³  ë‹¨ì–´ë¥¼ ëˆŒëŸ¬ ì¨ ë³´ì„¸ìš”.</div>
        <div id="wordCategoryRow" class="chip-row"></div>
        <div id="wordsList" class="list-scroll"></div>

        <div class="side-form">
          <div class="side-section-title">ë‚´ ë‹¨ì–´ ì¶”ê°€</div>
          <div class="sub-text">ì¶”ê°€í•œ ë‹¨ì–´ëŠ” â€˜ì»¤ìŠ¤í…€â€™ ì¹´í…Œê³ ë¦¬ì— ì €ì¥ë©ë‹ˆë‹¤.</div>
          <input id="customArabic" placeholder="ì•„ëì–´ ë‹¨ì–´ (ëª¨ìŒ í¬í•¨)" />
          <input id="customKorean" placeholder="ëœ» (í•œêµ­ì–´)" />
          <input id="customPron" placeholder="ë°œìŒ (ì„ íƒ)" />
          <button onclick="addCustomWord()">ì»¤ìŠ¤í…€ ë‹¨ì–´ ì €ì¥</button>
        </div>
      </aside>

      <!-- ì™¼ìª½ íŒ¨ë„: ë¬¸ì¥ -->
      <aside id="panel-sentences" class="side-panel hidden">
        <div class="panel-title">ë¬¸ì¥ ëª©ë¡</div>
        <div class="sub-text">ê¸°ë³¸ íšŒí™” / ìƒí™œ ë¬¸ì¥ì„ ê³¨ë¼ ì—°ìŠµí•´ ë³´ì„¸ìš”.</div>
        <div id="sentenceCategoryRow" class="chip-row"></div>
        <div id="sentencesList" class="sent-list"></div>
      </aside>

      <!-- ì˜¤ë¥¸ìª½ ì—°ìŠµ ì˜ì—­ -->
      <section class="practice">
        <!-- ë¬¸ì¥ ì„ íƒ ì¹´ë“œ (ë¬¸ì¥ íƒ­ì—ì„œë§Œ í‘œì‹œ) -->
        <div id="sentencePracticeBox" class="sentence-card hidden">
          <div class="sentence-row">
            <div>
              <div class="sentence-ko" id="selectedSentenceKo">ë¬¸ì¥ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.</div>
              <div class="sentence-ar" id="selectedSentenceAr"></div>
            </div>
          </div>
          <div class="btn-row">
            <button class="btn-sm" onclick="playSelectedSentence()">
              ğŸ”Š <span>ë¬¸ì¥ ë°œìŒ ë“£ê¸°</span>
            </button>
            <button class="btn-sm" onclick="copySentenceToTrace()">
              âœï¸ <span>ì´ ë¬¸ì¥ ë”°ë¼ ì“°ê¸°</span>
            </button>
          </div>
        </div>

        <!-- ë°œìŒ ì—°ìŠµ íŒ¨ë„ (ë¬¸ì¥ íƒ­ì—ì„œë§Œ) -->
        <div id="recordPanel" class="record-panel hidden">
          <div class="side-section-title">ë‚´ ë°œìŒ ì—°ìŠµ</div>
          <div class="record-row">
            <button class="btn-rec" onclick="startRecording()">ğŸ™ ë…¹ìŒ ì‹œì‘</button>
            <button class="btn-stop" onclick="stopRecording()">â–  ì •ì§€</button>
            <span id="recordStatus" class="record-status">ëŒ€ê¸° ì¤‘</span>
          </div>
          <audio id="playback" controls class="hidden"></audio>
        </div>

        <!-- ìƒë‹¨ ë¯¸ë¦¬ë³´ê¸° -->
        <div class="preview-row">
          <div id="currentLabel" class="current-label">
            ì™¼ìª½ì—ì„œ ììŒ, ëª¨ìŒ, ë‹¨ì–´ ë˜ëŠ” ë¬¸ì¥ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.
          </div>
          <div class="preview-box">
            <div id="previewText" class="preview-text"></div>
          </div>
        </div>

        <!-- ìº”ë²„ìŠ¤ 2ê°œ -->
        <div class="canvas-row">
          <div class="canvas-card">
            <div class="canvas-title-row">
              <div>1. ë”°ë¼ ì“°ê¸°</div>
              <div class="canvas-controls">
                <span>ì„  ë‘ê»˜</span>
                <input id="lineWidth1" type="range" min="2" max="10" value="4" />
                <button onclick="clearCanvas(0)">ì§€ìš°ê¸°</button>
              </div>
            </div>
            <canvas id="canvas1"></canvas>
          </div>
          <div class="canvas-card">
            <div class="canvas-title-row">
              <div>2. ì§ì ‘ ì¨ ë³´ê¸°</div>
              <div class="canvas-controls">
                <span>ì„  ë‘ê»˜</span>
                <input id="lineWidth2" type="range" min="2" max="10" value="4" />
                <button onclick="clearCanvas(1)">ì§€ìš°ê¸°</button>
              </div>
            </div>
            <canvas id="canvas2"></canvas>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    // ===== ë°ì´í„° =====

    const consonants = [
      { char: "Ø§", name: "alif", sound: "a / Ä" },
      { char: "Ø¨", name: "bÄÊ¼", sound: "b" },
      { char: "Øª", name: "tÄÊ¼", sound: "t" },
      { char: "Ø«", name: "thÄÊ¼", sound: "th" },
      { char: "Ø¬", name: "jÄ«m", sound: "j" },
      { char: "Ø­", name: "á¸¥ÄÊ¼", sound: "á¸¥" },
      { char: "Ø®", name: "khÄÊ¼", sound: "kh" },
      { char: "Ø¯", name: "dÄl", sound: "d" },
      { char: "Ø°", name: "dhÄl", sound: "dh" },
      { char: "Ø±", name: "rÄÊ¼", sound: "r" },
      { char: "Ø²", name: "zÄy", sound: "z" },
      { char: "Ø³", name: "sÄ«n", sound: "s" },
      { char: "Ø´", name: "shÄ«n", sound: "sh" },
      { char: "Øµ", name: "á¹£Äd", sound: "á¹£" },
      { char: "Ø¶", name: "á¸Äd", sound: "á¸" },
      { char: "Ø·", name: "á¹­ÄÊ¼", sound: "á¹­" },
      { char: "Ø¸", name: "áº“ÄÊ¼", sound: "áº“" },
      { char: "Ø¹", name: "Ê¿ayn", sound: "Ê¿" },
      { char: "Øº", name: "ghayn", sound: "gh" },
      { char: "Ù", name: "fÄÊ¼", sound: "f" },
      { char: "Ù‚", name: "qÄf", sound: "q" },
      { char: "Ùƒ", name: "kÄf", sound: "k" },
      { char: "Ù„", name: "lÄm", sound: "l" },
      { char: "Ù…", name: "mÄ«m", sound: "m" },
      { char: "Ù†", name: "nÅ«n", sound: "n" },
      { char: "Ù‡", name: "hÄÊ¼", sound: "h" },
      { char: "Ùˆ", name: "wÄw", sound: "w" },
      { char: "ÙŠ", name: "yÄÊ¼", sound: "y" }
    ];

    const vowels = [
      { char: "Ù", name: "fatá¸¥a", desc: "a (ì§§ì€ ëª¨ìŒ)" },
      { char: "Ù", name: "kasra", desc: "i (ì§§ì€ ëª¨ìŒ)" },
      { char: "Ù", name: "á¸amma", desc: "u (ì§§ì€ ëª¨ìŒ)" },
      { char: "Ø§", name: "alif", desc: "Ä (ê¸´ a)" },
      { char: "ÙŠ", name: "yÄÊ¼", desc: "Ä« (ê¸´ i)" },
      { char: "Ùˆ", name: "wÄw", desc: "Å« (ê¸´ u)" },
      { char: "Ù‹", name: "tanwÄ«n fatá¸¥", desc: "-an" },
      { char: "Ù", name: "tanwÄ«n kasr", desc: "-in" },
      { char: "ÙŒ", name: "tanwÄ«n á¸amm", desc: "-un" }
    ];

    const wordCategories = [
      "ì „ì²´",
      "ìƒ‰ê¹”",
      "ë‚ ì”¨",
      "ê³¼ì¼",
      "ì•¼ì±„",
      "êµí†µìˆ˜ë‹¨",
      "ë™ë¬¼",
      "ê°€ì¡±/ì‚¬ëŒ",
      "ì»¤ìŠ¤í…€"
    ];

    let wordData = [
      // ìƒ‰ê¹”
      { ar: "Ø£ÙØ­Ù’Ù…ÙØ±", ko: "ë¹¨ê°„ìƒ‰", pron: "aá¸¥mar", cat: "ìƒ‰ê¹”" },
      { ar: "Ø£ÙØ²Ù’Ø±ÙÙ‚", ko: "íŒŒë€ìƒ‰", pron: "azraq", cat: "ìƒ‰ê¹”" },
      { ar: "Ø£ÙØµÙ’ÙÙØ±", ko: "ë…¸ë€ìƒ‰", pron: "aá¹£far", cat: "ìƒ‰ê¹”" },
      { ar: "Ø£ÙØ®Ù’Ø¶ÙØ±", ko: "ì´ˆë¡ìƒ‰", pron: "akhá¸ar", cat: "ìƒ‰ê¹”" },
      { ar: "Ø£ÙØ³Ù’ÙˆÙØ¯", ko: "ê²€ì€ìƒ‰", pron: "aswad", cat: "ìƒ‰ê¹”" },
      { ar: "Ø£ÙØ¨Ù’ÙŠÙØ¶", ko: "í•˜ì–€ìƒ‰", pron: "abyaá¸", cat: "ìƒ‰ê¹”" },
      { ar: "Ø¨ÙÙ†Ù‘ÙÙŠÙ‘", ko: "ê°ˆìƒ‰", pron: "bunnÄ«y", cat: "ìƒ‰ê¹”" },
      { ar: "Ø¨ÙÙ†ÙÙÙ’Ø³ÙØ¬ÙÙŠÙ‘", ko: "ë³´ë¼ìƒ‰", pron: "banafsajÄ«y", cat: "ìƒ‰ê¹”" },
      // ë‚ ì”¨
      { ar: "Ù…ÙØ·ÙØ±", ko: "ë¹„", pron: "maá¹­ar", cat: "ë‚ ì”¨" },
      { ar: "Ø«ÙÙ„Ù’Ø¬", ko: "ëˆˆ (snow)", pron: "thalj", cat: "ë‚ ì”¨" },
      { ar: "Ø±ÙÙŠØ­", ko: "ë°”ëŒ", pron: "rÄ«á¸¥", cat: "ë‚ ì”¨" },
      { ar: "Ø­ÙØ§Ø±Ù‘", ko: "ë”ìš´ ë‚ ì”¨", pron: "á¸¥Ärr", cat: "ë‚ ì”¨" },
      { ar: "Ø¨ÙØ§Ø±ÙØ¯", ko: "ì¶”ìš´ ë‚ ì”¨", pron: "bÄrid", cat: "ë‚ ì”¨" },
      { ar: "ØµÙØ­Ù’Ùˆ", ko: "ë§‘ì€ ë‚ ì”¨", pron: "á¹£aá¸¥w", cat: "ë‚ ì”¨" },
      // ê³¼ì¼
      { ar: "ØªÙÙÙ‘ÙØ§Ø­ÙØ©", ko: "ì‚¬ê³¼", pron: "tuffÄá¸¥a", cat: "ê³¼ì¼" },
      { ar: "Ù…ÙÙˆÙ’Ø²ÙØ©", ko: "ë°”ë‚˜ë‚˜", pron: "mawza", cat: "ê³¼ì¼" },
      { ar: "Ø¹ÙÙ†ÙØ¨", ko: "í¬ë„", pron: "Ê¿inab", cat: "ê³¼ì¼" },
      { ar: "Ø¨ÙØ±Ù’ØªÙÙ‚ÙØ§Ù„ÙØ©", ko: "ì˜¤ë Œì§€", pron: "burtuqÄla", cat: "ê³¼ì¼" },
      { ar: "ÙÙØ±ÙØ§ÙˆÙ’Ù„ÙØ©", ko: "ë”¸ê¸°", pron: "farÄwla", cat: "ê³¼ì¼" },
      { ar: "Ø¨ÙØ·Ù‘ÙÙŠØ®", ko: "ìˆ˜ë°•", pron: "baá¹­á¹­Ä«kh", cat: "ê³¼ì¼" },
      // ì•¼ì±„
      { ar: "Ø¬ÙØ²ÙØ±", ko: "ë‹¹ê·¼", pron: "jazar", cat: "ì•¼ì±„" },
      { ar: "Ø¨ÙØµÙÙ„", ko: "ì–‘íŒŒ", pron: "baá¹£al", cat: "ì•¼ì±„" },
      { ar: "Ø·ÙÙ…ÙØ§Ø·ÙÙ…", ko: "í† ë§ˆí† ", pron: "á¹­amÄá¹­im", cat: "ì•¼ì±„" },
      { ar: "Ø®ÙÙŠÙØ§Ø±", ko: "ì˜¤ì´", pron: "khiyÄr", cat: "ì•¼ì±„" },
      { ar: "Ø³ÙÙ„ÙØ·ÙØ©", ko: "ìƒëŸ¬ë“œ", pron: "salata", cat: "ì•¼ì±„" },
      // êµí†µìˆ˜ë‹¨
      { ar: "Ø³ÙÙŠÙ‘ÙØ§Ø±ÙØ©", ko: "ìë™ì°¨", pron: "sayyÄra", cat: "êµí†µìˆ˜ë‹¨" },
      { ar: "Ø­ÙØ§ÙÙÙ„ÙØ©", ko: "ë²„ìŠ¤", pron: "á¸¥Äfila", cat: "êµí†µìˆ˜ë‹¨" },
      { ar: "Ù…ÙØªÙ’Ø±ÙÙˆ", ko: "ì§€í•˜ì² ", pron: "mitrÅ«", cat: "êµí†µìˆ˜ë‹¨" },
      { ar: "Ù‚ÙØ·ÙØ§Ø±", ko: "ê¸°ì°¨", pron: "qiá¹­Är", cat: "êµí†µìˆ˜ë‹¨" },
      { ar: "Ø·ÙØ§Ø¦ÙØ±ÙØ©", ko: "ë¹„í–‰ê¸°", pron: "á¹­ÄÊ¼ira", cat: "êµí†µìˆ˜ë‹¨" },
      // ë™ë¬¼
      { ar: "Ù‚ÙØ·Ù‘ÙØ©", ko: "ê³ ì–‘ì´", pron: "qiá¹­á¹­a", cat: "ë™ë¬¼" },
      { ar: "ÙƒÙÙ„Ù’Ø¨", ko: "ê°•ì•„ì§€", pron: "kalb", cat: "ë™ë¬¼" },
      { ar: "Ø³ÙÙ…ÙÙƒÙØ©", ko: "ë¬¼ê³ ê¸°", pron: "samaka", cat: "ë™ë¬¼" },
      { ar: "Ø·ÙØ§Ø¦ÙØ±", ko: "ìƒˆ", pron: "á¹­ÄÊ¼ir", cat: "ë™ë¬¼" },
      // ê°€ì¡±/ì‚¬ëŒ
      { ar: "Ø£ÙÙ…Ù‘", ko: "ì—„ë§ˆ", pron: "umm", cat: "ê°€ì¡±/ì‚¬ëŒ" },
      { ar: "Ø£ÙØ¨", ko: "ì•„ë¹ ", pron: "ab", cat: "ê°€ì¡±/ì‚¬ëŒ" },
      { ar: "Ø£ÙØ®Ù’Øª", ko: "ëˆ„ë‚˜ / ì–¸ë‹ˆ / ì—¬ë™ìƒ", pron: "ukht", cat: "ê°€ì¡±/ì‚¬ëŒ" },
      { ar: "Ø£ÙØ®", ko: "í˜• / ì˜¤ë¹  / ë‚¨ë™ìƒ", pron: "akh", cat: "ê°€ì¡±/ì‚¬ëŒ" },
      { ar: "ØµÙØ¯ÙÙŠÙ‚", ko: "ë‚¨ì ì¹œêµ¬ (friend)", pron: "á¹£adÄ«q", cat: "ê°€ì¡±/ì‚¬ëŒ" },
      { ar: "ØµÙØ¯ÙÙŠÙ‚ÙØ©", ko: "ì—¬ì ì¹œêµ¬ (friend)", pron: "á¹£adÄ«qa", cat: "ê°€ì¡±/ì‚¬ëŒ" }
    ];

    const sentenceCategories = ["ì „ì²´", "ê¸°ë³¸ ì¸ì‚¬", "ì¼ìƒ ëŒ€í™”", "í•™êµ/ê³µë¶€"];

    const sentences = [
      // ê¸°ë³¸ ì¸ì‚¬
      {
        ar: "Ø§Ù„Ø³Ù‘ÙÙ„ÙØ§Ù…Ù Ø¹ÙÙ„ÙÙŠÙ’ÙƒÙÙ…Ù’.",
        ko: "ì•ˆë…•í•˜ì„¸ìš”.",
        cat: "ê¸°ë³¸ ì¸ì‚¬"
      },
      {
        ar: "ÙˆÙØ¹ÙÙ„ÙÙŠÙ’ÙƒÙÙ…Ù Ø§Ù„Ø³Ù‘ÙÙ„ÙØ§Ù…Ù.",
        ko: "ì•ˆë…•í•˜ì„¸ìš”(ë‹µ ì¸ì‚¬).",
        cat: "ê¸°ë³¸ ì¸ì‚¬"
      },
      {
        ar: "ØµÙØ¨ÙØ§Ø­Ù Ø§Ù„Ù’Ø®ÙÙŠÙ’Ø±Ù.",
        ko: "ì¢‹ì€ ì•„ì¹¨ì…ë‹ˆë‹¤.",
        cat: "ê¸°ë³¸ ì¸ì‚¬"
      },
      {
        ar: "ØµÙØ¨ÙØ§Ø­Ù Ø§Ù„Ù†Ù‘ÙÙˆØ±Ù.",
        ko: "ì¢‹ì€ ì•„ì¹¨ì´ì—ìš”(ëŒ€ë‹µ).",
        cat: "ê¸°ë³¸ ì¸ì‚¬"
      },
      {
        ar: "Ù…ÙØ³ÙØ§Ø¡Ù Ø§Ù„Ù’Ø®ÙÙŠÙ’Ø±Ù.",
        ko: "ì¢‹ì€ ì €ë…ì…ë‹ˆë‹¤.",
        cat: "ê¸°ë³¸ ì¸ì‚¬"
      },
      {
        ar: "Ù…ÙØ³ÙØ§Ø¡Ù Ø§Ù„Ù†Ù‘ÙÙˆØ±Ù.",
        ko: "ì¢‹ì€ ì €ë…ì´ì—ìš”(ëŒ€ë‹µ).",
        cat: "ê¸°ë³¸ ì¸ì‚¬"
      },
      {
        ar: "Ù…ÙØ±Ù’Ø­ÙØ¨Ù‹Ø§!",
        ko: "ì•ˆë…•! / ë°˜ê°€ì›Œ!",
        cat: "ê¸°ë³¸ ì¸ì‚¬"
      },
      {
        ar: "Ø¥ÙÙ„ÙÙ‰ Ø§Ù„Ù„Ù‘ÙÙ‚ÙØ§Ø¡Ù.",
        ko: "ë˜ ë´ìš”.",
        cat: "ê¸°ë³¸ ì¸ì‚¬"
      },
      {
        ar: "ØªÙØµÙ’Ø¨ÙØ­Ù Ø¹ÙÙ„ÙÙ‰ Ø®ÙÙŠÙ’Ø±Ù.",
        ko: "ì˜ ììš”.",
        cat: "ê¸°ë³¸ ì¸ì‚¬"
      },
      {
        ar: "Ø´ÙÙƒÙ’Ø±Ù‹Ø§ Ø¬ÙØ²ÙÙŠÙ„Ù‹Ø§.",
        ko: "ì •ë§ ê³ ë§ˆì›Œìš”.",
        cat: "ê¸°ë³¸ ì¸ì‚¬"
      },
      {
        ar: "Ø¹ÙÙÙ’ÙˆÙ‹Ø§.",
        ko: "ì²œë§Œì—ìš”.",
        cat: "ê¸°ë³¸ ì¸ì‚¬"
      },
      // ì¼ìƒ ëŒ€í™”
      {
        ar: "ÙƒÙÙŠÙ’ÙÙ Ø­ÙØ§Ù„ÙÙƒÙØŸ",
        ko: "ì˜ ì§€ë‚´? (ë‚¨ìì—ê²Œ)",
        cat: "ì¼ìƒ ëŒ€í™”"
      },
      {
        ar: "ÙƒÙÙŠÙ’ÙÙ Ø­ÙØ§Ù„ÙÙƒÙØŸ",
        ko: "ì˜ ì§€ë‚´? (ì—¬ìì—ê²Œ)",
        cat: "ì¼ìƒ ëŒ€í™”"
      },
      {
        ar: "Ø£ÙÙ†ÙØ§ Ø¨ÙØ®ÙÙŠÙ’Ø±ÙØŒ ÙˆÙØ£ÙÙ†Ù’ØªÙØŸ",
        ko: "ë‚˜ ì˜ ì§€ë‚´, ë„ˆëŠ”? (ë‚¨ìì—ê²Œ)",
        cat: "ì¼ìƒ ëŒ€í™”"
      },
      {
        ar: "Ø£ÙÙ†ÙØ§ ØªÙØ¹Ù’Ø¨ÙØ§Ù†Ù Ù‚ÙÙ„ÙÙŠÙ„Ù‹Ø§.",
        ko: "ë‚˜ ì¡°ê¸ˆ í”¼ê³¤í•´.",
        cat: "ì¼ìƒ ëŒ€í™”"
      },
      {
        ar: "Ù…ÙØ§ Ø§Ø³Ù’Ù…ÙÙƒÙØŸ",
        ko: "ì´ë¦„ì´ ë­ì•¼? (ë‚¨ìì—ê²Œ)",
        cat: "ì¼ìƒ ëŒ€í™”"
      },
      {
        ar: "Ù…ÙØ§ Ø§Ø³Ù’Ù…ÙÙƒÙØŸ",
        ko: "ì´ë¦„ì´ ë­ì•¼? (ì—¬ìì—ê²Œ)",
        cat: "ì¼ìƒ ëŒ€í™”"
      },
      {
        ar: "Ø§ÙØ³Ù’Ù…ÙÙŠ Ø¬ÙÙ‡ÙÙˆÙ†.",
        ko: "ë‚´ ì´ë¦„ì€ ì§€í›ˆì´ì•¼.",
        cat: "ì¼ìƒ ëŒ€í™”"
      },
      {
        ar: "Ù…ÙÙ†Ù’ Ø£ÙÙŠÙ’Ù†Ù Ø£ÙÙ†Ù’ØªÙØŸ",
        ko: "ì–´ë”” ì‚¬ëŒì´ì•¼? (ë‚¨ìì—ê²Œ)",
        cat: "ì¼ìƒ ëŒ€í™”"
      },
      {
        ar: "Ø£ÙÙ†ÙØ§ Ù…ÙÙ†Ù’ ÙƒÙÙˆØ±ÙÙŠÙØ§.",
        ko: "ë‚˜ëŠ” í•œêµ­ ì‚¬ëŒì´ì•¼.",
        cat: "ì¼ìƒ ëŒ€í™”"
      },
      {
        ar: "ÙƒÙÙ…Ù’ Ø¹ÙÙ…Ù’Ø±ÙÙƒÙØŸ",
        ko: "ëª‡ ì‚´ì´ì•¼? (ë‚¨ìì—ê²Œ)",
        cat: "ì¼ìƒ ëŒ€í™”"
      },
      {
        ar: "Ø£ÙÙ†ÙØ§ ÙÙÙŠ Ø§Ù„Ù’Ø¹ÙØ´Ù’Ø±ÙÙŠÙ†ÙØ§ØªÙ.",
        ko: "ë‚˜ 20ëŒ€ì•¼.",
        cat: "ì¼ìƒ ëŒ€í™”"
      },
      {
        ar: "Ù…ÙØ§Ø°ÙØ§ ØªÙÙÙ’Ø¹ÙÙ„Ù Ø§Ù„Ù’ÙŠÙÙˆÙ’Ù…ÙØŸ",
        ko: "ì˜¤ëŠ˜ ë­ í•´?",
        cat: "ì¼ìƒ ëŒ€í™”"
      },
      {
        ar: "Ø£ÙÙ†ÙØ§ Ø£ÙØ¯Ù’Ø±ÙØ³Ù Ø§Ù„Ù’Ø¹ÙØ±ÙØ¨ÙÙŠÙ‘ÙØ©Ù.",
        ko: "ë‚˜ ì•„ëì–´ ê³µë¶€í•´.",
        cat: "ì¼ìƒ ëŒ€í™”"
      },
      {
        ar: "Ù‡ÙÙ„Ù’ ØªÙØ­ÙØ¨Ù‘Ù Ø§Ù„Ù’Ù‚ÙÙ‡Ù’ÙˆÙØ©ÙØŸ",
        ko: "ì»¤í”¼ ì¢‹ì•„í•´?",
        cat: "ì¼ìƒ ëŒ€í™”"
      },
      {
        ar: "Ù†ÙØ¹ÙÙ…Ù’ØŒ Ø£ÙØ­ÙØ¨Ù‘ÙÙ‡ÙØ§ ÙƒÙØ«ÙÙŠØ±Ù‹Ø§.",
        ko: "ì‘, ë§ì´ ì¢‹ì•„í•´.",
        cat: "ì¼ìƒ ëŒ€í™”"
      },
      {
        ar: "Ù„ÙØ§ØŒ Ù„ÙØ§ Ø£ÙØ­ÙØ¨Ù‘ÙÙ‡ÙØ§.",
        ko: "ì•„ë‹ˆ, ì•ˆ ì¢‹ì•„í•´.",
        cat: "ì¼ìƒ ëŒ€í™”"
      },
      {
        ar: "Ø£ÙÙŠÙ’Ù†Ù ØªÙØ³Ù’ÙƒÙÙ†ÙØŸ",
        ko: "ì–´ë”” ì‚´ì•„?",
        cat: "ì¼ìƒ ëŒ€í™”"
      },
      {
        ar: "Ø£ÙØ³Ù’ÙƒÙÙ†Ù ÙÙÙŠ Ø³ÙÙŠØ¦ÙÙˆÙ„Ù.",
        ko: "ë‚˜ëŠ” ì„œìš¸ì— ì‚´ì•„.",
        cat: "ì¼ìƒ ëŒ€í™”"
      },
      {
        ar: "Ø¹ÙÙ†Ù’Ø¯ÙÙŠ Ø³ÙØ¤ÙØ§Ù„ÙŒ ØµÙØºÙÙŠØ±ÙŒ.",
        ko: "ì‘ì€ ì§ˆë¬¸ í•˜ë‚˜ ìˆì–´.",
        cat: "ì¼ìƒ ëŒ€í™”"
      },
      // í•™êµ / ê³µë¶€
      {
        ar: "Ø£ÙÙ†ÙØ§ Ø·ÙØ§Ù„ÙØ¨ÙØ©ÙŒ ÙÙÙŠ Ø§Ù„Ù’Ø¬ÙØ§Ù…ÙØ¹ÙØ©Ù.",
        ko: "ë‚˜ëŠ” ëŒ€í•™ìƒì´ì•¼. (ì—¬ì)",
        cat: "í•™êµ/ê³µë¶€"
      },
      {
        ar: "Ø£ÙÙ†ÙØ§ Ø£ÙØ¯Ù’Ø±ÙØ³Ù Ø§Ù„Ù„Ù‘ÙØºÙØ©Ù Ø§Ù„Ù’Ø¹ÙØ±ÙØ¨ÙÙŠÙ‘ÙØ©Ù.",
        ko: "ë‚˜ëŠ” ì•„ëì–´ë¥¼ ê³µë¶€í•´.",
        cat: "í•™êµ/ê³µë¶€"
      },
      {
        ar: "Ù„ÙØ¯ÙÙŠÙ‘Ù ÙˆÙØ§Ø¬ÙØ¨ÙŒ ÙƒÙØ«ÙÙŠØ±ÙŒ Ø§Ù„Ù’ÙŠÙÙˆÙ’Ù…Ù.",
        ko: "ì˜¤ëŠ˜ ìˆ™ì œê°€ ë§ì•„.",
        cat: "í•™êµ/ê³µë¶€"
      },
      {
        ar: "Ù‡ÙÙ„Ù’ Ø¹ÙÙ†Ù’Ø¯ÙÙƒÙ Ø¯ÙØ±Ù’Ø³ÙŒ ØºÙØ¯Ù‹Ø§ØŸ",
        ko: "ë‚´ì¼ ìˆ˜ì—… ìˆì–´?",
        cat: "í•™êµ/ê³µë¶€"
      },
      {
        ar: "Ù„ÙØ§ØŒ Ù„ÙÙŠÙ’Ø³Ù Ø¹ÙÙ†Ù’Ø¯ÙÙŠ Ø¯ÙØ±Ù’Ø³ÙŒ ØºÙØ¯Ù‹Ø§.",
        ko: "ì•„ë‹ˆ, ë‚´ì¼ì€ ìˆ˜ì—… ì—†ì–´.",
        cat: "í•™êµ/ê³µë¶€"
      },
      {
        ar: "Ù†ÙØ°Ù’Ù‡ÙØ¨Ù Ø¥ÙÙ„ÙÙ‰ Ø§Ù„Ù’Ù…ÙÙƒÙ’ØªÙØ¨ÙØ©Ù Ù…ÙØ¹Ù‹Ø§ØŸ",
        ko: "ê°™ì´ ë„ì„œê´€ ê°ˆë˜?",
        cat: "í•™êµ/ê³µë¶€"
      },
      {
        ar: "Ø£ÙØ±ÙÙŠØ¯Ù Ø£ÙÙ†Ù’ Ø£ÙØ±ÙØ§Ø¬ÙØ¹Ù Ø§Ù„Ù’Ù…ÙÙÙ’Ø±ÙÙˆØ¶ÙØ§ØªÙ.",
        ko: "ê³¼ì œë¥¼ ë³µìŠµí•˜ê³  ì‹¶ì–´.",
        cat: "í•™êµ/ê³µë¶€"
      },
      {
        ar: "Ø§Ù„ÙØ§Ù…Ù’ØªÙØ­ÙØ§Ù†Ù Ù‚ÙØ±ÙÙŠØ¨ÙŒ.",
        ko: "ì‹œí—˜ì´ ê³§ì´ì•¼.",
        cat: "í•™êµ/ê³µë¶€"
      },
      {
        ar: "Ù„ÙØ§ Ø£ÙÙ‚Ù’Ù„ÙÙ‚Ù’ØŒ Ù†ÙØ³Ù’ØªÙØ·ÙÙŠØ¹Ù Ø§Ù„Ù†Ù‘ÙØ¬ÙØ§Ø­Ù.",
        ko: "ê±±ì • ë§ˆ, ìš°ë¦¬ ì˜í•  ìˆ˜ ìˆì–´.",
        cat: "í•™êµ/ê³µë¶€"
      }
    ];

    // ì»¤ìŠ¤í…€ ë‹¨ì–´ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°
    const CUSTOM_KEY = "arabicPracticeCustomWords";

    function loadCustomWords() {
      try {
        const saved = localStorage.getItem(CUSTOM_KEY);
        if (!saved) return;
        const parsed = JSON.parse(saved);
        parsed.forEach((w) => wordData.push(w));
      } catch (e) {
        console.warn("custom word load error", e);
      }
    }

    function saveCustomWords() {
      const customOnly = wordData.filter((w) => w.cat === "ì»¤ìŠ¤í…€");
      localStorage.setItem(CUSTOM_KEY, JSON.stringify(customOnly));
    }

    // ===== ì „ì—­ ìƒíƒœ =====
    let currentTab = "letters";
    let currentTraceText = "";
    let currentTraceLabel = "";
    let currentSentence = null;

    // ===== ì´ˆê¸°í™” =====

    function initLetters() {
      const container = document.getElementById("lettersList");
      container.innerHTML = "";
      consonants.forEach((letter) => {
        const div = document.createElement("div");
        div.className = "list-item";

        const big = document.createElement("div");
        big.className = "letter-card-letter";
        big.textContent = letter.char;

        const nameLine = document.createElement("div");
        nameLine.className = "letter-card-sub";
        nameLine.textContent = letter.name;

        const soundLine = document.createElement("div");
        soundLine.className = "letter-card-sub";
        soundLine.textContent = letter.sound;

        div.appendChild(big);
        div.appendChild(nameLine);
        div.appendChild(soundLine);

        div.onclick = () => {
          setTraceText(letter.char, "ììŒ: " + letter.name);
          speakArabic(letter.char);
        };

        container.appendChild(div);
      });
    }

    function initVowels() {
      const container = document.getElementById("vowelsList");
      container.innerHTML = "";
      vowels.forEach((v) => {
        const div = document.createElement("div");
        div.className = "list-item";
        const row = document.createElement("div");
        row.className = "list-item-title";

        const ar = document.createElement("div");
        ar.className = "list-arabic";
        ar.textContent = v.char;

        const name = document.createElement("div");
        name.className = "list-korean";
        name.textContent = v.name;

        row.appendChild(ar);
        row.appendChild(name);

        const desc = document.createElement("div");
        desc.className = "list-extra";
        desc.textContent = v.desc;

        div.appendChild(row);
        div.appendChild(desc);

        div.onclick = () => {
          setTraceText(v.char, "ëª¨ìŒ: " + v.name);
          speakArabic(v.char);
        };

        container.appendChild(div);
      });
    }

    let currentWordCategory = "ì „ì²´";

    function initWordCategories() {
      const row = document.getElementById("wordCategoryRow");
      row.innerHTML = "";
      wordCategories.forEach((cat) => {
        const btn = document.createElement("button");
        btn.className = "chip" + (cat === currentWordCategory ? " active" : "");
        btn.textContent = cat;
        btn.onclick = () => {
          currentWordCategory = cat;
          initWordCategories();
          renderWords();
        };
        row.appendChild(btn);
      });
    }

    function renderWords() {
      const container = document.getElementById("wordsList");
      container.innerHTML = "";
      wordData
        .filter(
          (w) => currentWordCategory === "ì „ì²´" || w.cat === currentWordCategory
        )
        .forEach((w) => {
          const div = document.createElement("div");
          div.className = "list-item";

          const top = document.createElement("div");
          top.className = "list-item-title";

          const ar = document.createElement("div");
          ar.className = "list-arabic";
          ar.textContent = w.ar;

          const ko = document.createElement("div");
          ko.className = "list-korean";
          ko.textContent = w.ko;

          top.appendChild(ar);
          top.appendChild(ko);

          const extra = document.createElement("div");
          extra.className = "list-extra";
          extra.textContent =
            (w.pron ? w.pron + " Â· " : "") + (w.cat === "ì»¤ìŠ¤í…€" ? "ì»¤ìŠ¤í…€" : w.cat);

          div.appendChild(top);
          div.appendChild(extra);

          div.onclick = () => {
            setTraceText(w.ar, `ë‹¨ì–´: ${w.ko}`);
            speakArabic(w.ar);
          };

          container.appendChild(div);
        });
    }

    function addCustomWord() {
      const ar = document.getElementById("customArabic").value.trim();
      const ko = document.getElementById("customKorean").value.trim();
      const pr = document.getElementById("customPron").value.trim();

      if (!ar || !ko) {
        alert("ì•„ëì–´ ë‹¨ì–´ì™€ ëœ»ì„ ëª¨ë‘ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
        return;
      }

      const newWord = {
        ar,
        ko,
        pron: pr || "",
        cat: "ì»¤ìŠ¤í…€"
      };
      wordData.push(newWord);
      saveCustomWords();

      document.getElementById("customArabic").value = "";
      document.getElementById("customKorean").value = "";
      document.getElementById("customPron").value = "";

      currentWordCategory = "ì»¤ìŠ¤í…€";
      initWordCategories();
      renderWords();
    }

    // ë¬¸ì¥

    let currentSentenceCategory = "ì „ì²´";

    function initSentenceCategories() {
      const row = document.getElementById("sentenceCategoryRow");
      row.innerHTML = "";
      sentenceCategories.forEach((cat) => {
        const btn = document.createElement("button");
        btn.className = "chip" + (cat === currentSentenceCategory ? " active" : "");
        btn.textContent = cat;
        btn.onclick = () => {
          currentSentenceCategory = cat;
          initSentenceCategories();
          renderSentences();
        };
        row.appendChild(btn);
      });
    }

    function renderSentences() {
      const container = document.getElementById("sentencesList");
      container.innerHTML = "";
      sentences
        .filter(
          (s) => currentSentenceCategory === "ì „ì²´" || s.cat === currentSentenceCategory
        )
        .forEach((s) => {
          const item = document.createElement("div");
          item.className = "sent-item";

          const ar = document.createElement("div");
          ar.className = "sent-ar-list";
          ar.textContent = s.ar;

          const ko = document.createElement("div");
          ko.className = "sent-ko-list";
          ko.textContent = `${s.ko} (${s.cat})`;

          item.appendChild(ar);
          item.appendChild(ko);

          item.onclick = () => {
            selectSentence(s);
          };

          container.appendChild(item);
        });
    }

    function selectSentence(s) {
      currentSentence = s;
      document.getElementById("selectedSentenceKo").textContent = s.ko;
      document.getElementById("selectedSentenceAr").textContent = s.ar;
      document.getElementById("sentencePracticeBox").classList.remove("hidden");
      document.getElementById("recordPanel").classList.remove("hidden");

      setTraceText(s.ar, "ë¬¸ì¥ ì—°ìŠµ");
    }

    function playSelectedSentence() {
      if (!currentSentence) return;
      speakArabic(currentSentence.ar);
    }

    function copySentenceToTrace() {
      if (!currentSentence) return;
      setTraceText(currentSentence.ar, "ë¬¸ì¥ ì—°ìŠµ");
    }

    // ===== íƒ­ ì „í™˜ =====
    function setTab(tab) {
      currentTab = tab;

      document.querySelectorAll(".nav-tab").forEach((btn) => {
        btn.classList.toggle("active", btn.dataset.tab === tab);
      });

      document
        .getElementById("panel-letters")
        .classList.toggle("hidden", tab !== "letters");
      document
        .getElementById("panel-vowels")
        .classList.toggle("hidden", tab !== "vowels");
      document
        .getElementById("panel-words")
        .classList.toggle("hidden", tab !== "words");
      document
        .getElementById("panel-sentences")
        .classList.toggle("hidden", tab !== "sentences");

      const recordPanel = document.getElementById("recordPanel");
      const sentenceBox = document.getElementById("sentencePracticeBox");

      if (tab === "sentences") {
        recordPanel.classList.remove("hidden");
        if (currentSentence) {
          sentenceBox.classList.remove("hidden");
        }
      } else {
        recordPanel.classList.add("hidden");
        sentenceBox.classList.add("hidden");
      }

      if (tab === "letters") {
        document.getElementById("currentLabel").textContent =
          "ììŒì„ ì„ íƒí•˜ë©´ ì—¬ê¸°ì—ì„œ ë¯¸ë¦¬ ë³¼ ìˆ˜ ìˆì–´ìš”.";
      } else if (tab === "vowels") {
        document.getElementById("currentLabel").textContent =
          "ëª¨ìŒì„ ì„ íƒí•˜ë©´ ì—¬ê¸°ì—ì„œ ë¯¸ë¦¬ ë³¼ ìˆ˜ ìˆì–´ìš”.";
      } else if (tab === "words") {
        document.getElementById("currentLabel").textContent =
          "ë‹¨ì–´ë¥¼ ì„ íƒí•˜ë©´ ì—¬ê¸°ì—ì„œ ë¯¸ë¦¬ ë³¼ ìˆ˜ ìˆì–´ìš”.";
      } else if (tab === "sentences") {
        document.getElementById("currentLabel").textContent =
          "ë¬¸ì¥ì„ ì„ íƒí•˜ë©´ ë”°ë¼ ì“°ê¸°ì™€ ë°œìŒ ì—°ìŠµì„ í•  ìˆ˜ ìˆì–´ìš”.";
      }
    }

    // ===== TTS =====
    function speakArabic(text) {
      if (!("speechSynthesis" in window)) return;
      const u = new SpeechSynthesisUtterance(text);
      u.lang = "ar-SA";
      u.rate = 0.9;
      window.speechSynthesis.speak(u);
    }

    // ===== ìº”ë²„ìŠ¤ =====
    const canvases = [];
    const ctxs = [];
    const drawing = [false, false];
    const lastPos = [
      { x: 0, y: 0 },
      { x: 0, y: 0 }
    ];

    function resizeCanvases() {
      canvases.forEach((cv) => {
        const rect = cv.getBoundingClientRect();
        const ratio = window.devicePixelRatio || 1;
        cv.width = rect.width * ratio;
        cv.height = rect.height * ratio;
        const ctx = cv.getContext("2d");
        ctx.scale(ratio, ratio);
      });
      if (currentTraceText) {
        drawGuide();
      }
    }

    function setTraceText(text, label) {
      currentTraceText = text;
      currentTraceLabel = label;
      document.getElementById("previewText").textContent = text;
      document.getElementById("currentLabel").textContent = label;
      clearCanvas(0);
      clearCanvas(1);
      drawGuide();
    }

    function drawGuide() {
      if (!currentTraceText) return;
      const cv = canvases[0];
      const ctx = ctxs[0];
      if (!cv || !ctx) return;

      ctx.save();
      ctx.clearRect(0, 0, cv.width, cv.height);
      ctx.fillStyle = "#ffffff";
      ctx.fillRect(0, 0, cv.width, cv.height);

      // í…ìŠ¤íŠ¸ í¬ê¸° ìë™ ì¡°ì ˆ (ì–‘ ì˜† ì•ˆ ì˜ë¦¬ê²Œ)
      ctx.fillStyle = "#e5e7eb";
      const baseSize = 180;
      ctx.font = `${baseSize}px "Scheherazade New","Amiri",serif`;
      const metrics = ctx.measureText(currentTraceText);
      const width = metrics.width;
      const maxWidth = cv.width / (window.devicePixelRatio || 1) * 0.78;
      let fontSize = baseSize;
      if (width > maxWidth) {
        const scale = maxWidth / width;
        fontSize = baseSize * scale;
      }
      ctx.font = `${fontSize}px "Scheherazade New","Amiri",serif`;
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      const ratio = window.devicePixelRatio || 1;
      ctx.translate(cv.width / 2, cv.height / 2);
      ctx.globalAlpha = 0.2;
      ctx.fillText(currentTraceText, 0, 0);
      ctx.restore();
    }

    function clearCanvas(idx) {
      const cv = canvases[idx];
      const ctx = ctxs[idx];
      if (!cv || !ctx) return;
      ctx.clearRect(0, 0, cv.width, cv.height);
      ctx.fillStyle = "#ffffff";
      ctx.fillRect(0, 0, cv.width, cv.height);
      if (idx === 0 && currentTraceText) {
        drawGuide();
      }
    }

    function getLineWidth(idx) {
      const slider = document.getElementById(idx === 0 ? "lineWidth1" : "lineWidth2");
      return Number(slider.value) || 4;
    }

    function startDraw(e, idx) {
      e.preventDefault();
      drawing[idx] = true;
      const pos = getPos(e, idx);
      lastPos[idx] = pos;
    }

    function moveDraw(e, idx) {
      if (!drawing[idx]) return;
      e.preventDefault();
      const pos = getPos(e, idx);
      const ctx = ctxs[idx];
      ctx.strokeStyle = "#111827";
      ctx.lineWidth = getLineWidth(idx);
      ctx.lineCap = "round";
      ctx.beginPath();
      ctx.moveTo(lastPos[idx].x, lastPos[idx].y);
      ctx.lineTo(pos.x, pos.y);
      ctx.stroke();
      lastPos[idx] = pos;
    }

    function endDraw(e, idx) {
      drawing[idx] = false;
    }

    function getPos(e, idx) {
      const cv = canvases[idx];
      const rect = cv.getBoundingClientRect();
      let clientX, clientY;
      if (e.touches && e.touches[0]) {
        clientX = e.touches[0].clientX;
        clientY = e.touches[0].clientY;
      } else {
        clientX = e.clientX;
        clientY = e.clientY;
      }
      const x = clientX - rect.left;
      const y = clientY - rect.top;
      return { x, y };
    }

    function attachCanvasEvents() {
      canvases.forEach((cv, idx) => {
        cv.addEventListener("mousedown", (e) => startDraw(e, idx));
        cv.addEventListener("mousemove", (e) => moveDraw(e, idx));
        window.addEventListener("mouseup", (e) => endDraw(e, idx));

        cv.addEventListener("touchstart", (e) => startDraw(e, idx), {
          passive: false
        });
        cv.addEventListener("touchmove", (e) => moveDraw(e, idx), {
          passive: false
        });
        cv.addEventListener("touchend", (e) => endDraw(e, idx));
      });
    }

    // ===== ë…¹ìŒ =====
    let mediaRecorder = null;
    let audioChunks = [];

    async function startRecording() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(stream);
        audioChunks = [];

        mediaRecorder.ondataavailable = (e) => {
          if (e.data.size > 0) audioChunks.push(e.data);
        };

        mediaRecorder.onstop = () => {
          const blob = new Blob(audioChunks, { type: "audio/webm" });
          const url = URL.createObjectURL(blob);
          const audio = document.getElementById("playback");
          audio.src = url;
          audio.classList.remove("hidden");
        };

        mediaRecorder.start();
        document.getElementById("recordStatus").textContent = "ë…¹ìŒ ì¤‘...";
      } catch (err) {
        alert("ë§ˆì´í¬ ê¶Œí•œì„ í—ˆìš©í•´ ì£¼ì„¸ìš”.");
        console.error(err);
      }
    }

    function stopRecording() {
      if (mediaRecorder && mediaRecorder.state !== "inactive") {
        mediaRecorder.stop();
        document.getElementById("recordStatus").textContent = "ë…¹ìŒ ì™„ë£Œ!";
      }
    }

    // ===== ì´ˆê¸° ì‹¤í–‰ =====
    window.addEventListener("load", () => {
      loadCustomWords();
      initLetters();
      initVowels();
      initWordCategories();
      renderWords();
      initSentenceCategories();
      renderSentences();

      canvases[0] = document.getElementById("canvas1");
      canvases[1] = document.getElementById("canvas2");
      ctxs[0] = canvases[0].getContext("2d");
      ctxs[1] = canvases[1].getContext("2d");

      resizeCanvases();
      attachCanvasEvents();

      document.getElementById("previewText").textContent = "";
      setTab("letters");
    });

    window.addEventListener("resize", () => {
      resizeCanvases();
    });
  </script>
</body>
                            </html>
