    <!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Arabic Practice Lab</title>
  <style>
    * {
      box-sizing: border-box;
    }
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
      background-color: #f3f4f6;
      color: #111827;
    }
    body {
      display: flex;
      flex-direction: column;
    }

    /* ìƒë‹¨ í—¤ë” */
    .app-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 20px;
      background: #111827;
      color: #f9fafb;
    }
    .app-title {
      font-weight: 700;
      font-size: 1rem;
    }
    .tab-bar {
      display: flex;
      gap: 8px;
    }
    .tab-btn {
      padding: 6px 14px;
      border-radius: 999px;
      border: none;
      font-size: 0.85rem;
      cursor: pointer;
      background: #1f2937;
      color: #e5e7eb;
      transition: background 0.15s, color 0.15s;
    }
    .tab-btn.active {
      background: #facc15;
      color: #111827;
      font-weight: 600;
    }

    /* ë©”ì¸ ë ˆì´ì•„ì›ƒ */
    .app-main {
      flex: 1;
      display: flex;
      height: calc(100vh - 52px);
      overflow: hidden;
    }
      /* ê¸´ ê¸€ íƒ­ì¼ ë•ŒëŠ” mainì— ì„¸ë¡œ ìŠ¤í¬ë¡¤ í—ˆìš© */
body.long-mode main {
   height: auto;                             /* ë‚´ìš© ê¸¸ì´ì— ë§ì¶° ëŠ˜ì–´ë‚¨ */
  min-height: calc(100vh - 52px);           /* í™”ë©´ ë†’ì´ë³´ë‹¤ ë„ˆë¬´ ì‘ì•„ì§€ì§€ ì•Šê²Œ */
  overflow-y: auto;                         /* ì„¸ë¡œ ìŠ¤í¬ë¡¤ ì—´ê¸° */
  overflow-x: hidden;
}

    .side-panel {
      width: 260px;
      min-width: 220px;
      max-width: 300px;
      padding: 12px;
      border-right: 1px solid #e5e7eb;
      background: #f9fafb;
      overflow-y: auto;
    }
    .side-title {
      font-size: 0.9rem;
      font-weight: 700;
      margin-bottom: 4px;
    }
    .side-sub {
      font-size: 0.75rem;
      color: #6b7280;
      margin-bottom: 10px;
    }

    .letter-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 8px;
    }

     #wordsList.letter-grid {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }
    
    .card {
      border-radius: 14px;
      padding: 6px 8px;
      background: white;
      border: 1px solid #e5e7eb;
      box-shadow: 0 1px 2px rgba(0,0,0,0.03);
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      transition: box-shadow 0.15s, border-color 0.15s, transform 0.05s;
    }
    .card:hover {
      box-shadow: 0 4px 8px rgba(0,0,0,0.06);
      border-color: #d1d5db;
      transform: translateY(-1px);
    }
    .card.active {
      border-color: #f97316;
      box-shadow: 0 0 0 1px rgba(249,115,22,0.5);
    }
    .card-ar {
      font-size: 1.4rem;
      margin-bottom: 2px;
    }
    .card-name {
      font-size: 0.7rem;
      color: #374151;
    }
    .card-sound {
      font-size: 0.6rem;
      color: #6b7280;
    }

    /* ë©”ì¸ ìš°ì¸¡ ì˜ì—­ */
    .content-panel {
      flex: 1;
      padding: 12px 16px 16px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      overflow: hidden;
    }
/* ê¸´ ê¸€ íƒ­ì—ì„œëŠ” í•œêµ­ì–´ ëœ»ì´ ì˜ë¦¬ì§€ ì•Šë„ë¡ ì˜¤ë²„í”Œë¡œìš° í•´ì œ */
body.long-mode .content-panel {
  overflow: visible;
}

      
    /* ì„ íƒ ì •ë³´ ì¹´ë“œ */
    .selection-card {
      background: white;
      border-radius: 14px;
      border: 1px solid #e5e7eb;
      padding: 10px 14px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      min-height: 64px;
    }
/* ê¸´ ê¸€ íƒ­ì¼ ë•Œ: ìƒë‹¨ ì¹´ë“œë¥¼ ì„¸ë¡œ ë°°ì¹˜ë¡œ ë°”ê¾¸ê¸° */
.selection-card.longtext-mode {
  flex-direction: column;    /* ìœ„ì— í…ìŠ¤íŠ¸, ì•„ë˜ì— ë²„íŠ¼ */
  align-items: flex-start;
  gap: 8px;
}

.selection-card.longtext-mode .selection-right {
  align-self: flex-start;    /* ë²„íŠ¼ ë¬¶ìŒë„ ì™¼ìª½ ì •ë ¬ */
}

      
       .selection-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 6px;
    }

/* ê¸´ ê¸€ íƒ­ì—ì„œ íˆ´ë°”ë¥¼ ê°€ë¡œ í•œ ì¤„ + ì¢Œìš° ë¶„ë¦¬ */
.selection-card.longtext-toolbar .selection-right {
  flex-direction: row;
  align-items: center;     /* ì„¸ë¡œ ì •ë ¬(í•˜ë‹¨) ë§ì¶”ê¸° */
  flex-wrap: nowrap;       /* ì¤„ë°”ê¿ˆ ì—†ì´ í•œ ì¤„ ìœ ì§€ */
  gap: 8px;
  width: 100%;             /* ì™¼ìª½Â·ì˜¤ë¥¸ìª½ìœ¼ë¡œ ê³µê°„ ë‚˜ëˆ„ê¸° */
}


    .record-mini {
      display: flex;
      flex-direction: column;
      gap: 3px;
      align-items: flex-end;
    }
    .record-mini-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      justify-content: flex-end;
    }
    .record-mini-status {
      font-size: 0.7rem;
      color: #6b7280;
      text-align: right;
    }

    .selection-main {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .selection-top-line {
      display: flex;
      align-items: baseline;
      gap: 12px;
      flex-wrap: wrap;
    }
    .selection-ar {
      font-size: 1.25rem;   /* 1.6 â†’ 1.25ë¡œ ì¤„ì´ê¸° */
  font-weight: 600;
  direction: rtl;
  font-family: "Scheherazade New", "Noto Naskh Arabic", system-ui, sans-serif;
    }
    .selection-type {
      font-size: 0.7rem;
      padding: 2px 6px;
      border-radius: 999px;
      background: #eef2ff;
      color: #4f46e5;
      font-weight: 600;
    }
    .selection-extra {
      font-size: 0.75rem;
      color: #4b5563;
      
    }
    .selection-extra span {
      white-space: nowrap;
    }
    .selection-forms {
      font-size: 0.7rem;
      color: #6b7280;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 4px;
    }
    .selection-form-label {
      color: #9ca3af;
    }
        .selection-form-btn {
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      cursor: pointer;
      font-size: 0.7rem;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .selection-form-btn .form-label {
      color: #9ca3af;
    }
    .selection-form-btn .form-ar {
      direction: rtl;
      font-family: "Scheherazade New", "Noto Naskh Arabic", system-ui, sans-serif;
      font-size: 1.1rem;
    }

      .play-btn {
  border-radius: 999px;
  border: none;
  padding: 4px 10px;      /* íŒ¨ë”© ì¶•ì†Œ */
  font-size: 0.75rem;     /* ê¸€ì ì‚´ì§ ì¤„ì´ê¸° */
  cursor: pointer;
  background: #111827;
  color: #f9fafb;
  display: inline-flex;
  align-items: center;
  gap: 4px;
}

    
      .guide-toggle-btn {
  margin-top: 4px;
  border-radius: 999px;
  border: 1px solid #e5e7eb;
  background: #f9fafb;
  padding: 3px 8px;
  font-size: 0.7rem;
  cursor: pointer;
  color: #374151;
  display: none;
}

      .longtext-page-controls {
  margin-top: 6px;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-size: 0.75rem;
}

.page-btn {
  border-radius: 999px;
  border: 1px solid #e5e7eb;
  background: #f9fafb;
  padding: 2px 6px;
  font-size: 0.7rem;
  cursor: pointer;
  color: #374151;
}


.page-btn:disabled {
  opacity: 0.4;
  cursor: default;
}

.page-info {
  font-size: 0.75rem;
  color: #6b7280;
}

      
    .play-btn span {
      font-size: 0.9rem;
    }
        .record-card {
      background: white;
      border-radius: 14px;
      border: 1px solid #e5e7eb;
      padding: 10px 14px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .record-title {
      font-size: 0.85rem;
      font-weight: 600;
      color: #374151;
    }
    .record-sub {
      font-size: 0.75rem;
      color: #6b7280;
    }
    .record-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 4px;
    }

      .record-btn {
  padding: 4px 8px;
  border-radius: 999px;
  border: none;
  font-size: 0.7rem;
  cursor: pointer;
  background: #e5e7eb;
  color: #111827;
}

      
    .record-btn:disabled {
      opacity: 0.4;
      cursor: default;
    }
    .record-status {
      font-size: 0.75rem;
      color: #4b5563;
    }


    /* ìº”ë²„ìŠ¤ ì˜ì—­ */
    .canvas-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 10px;
      overflow: hidden;

    }
      body.long-mode .canvas-section {
  overflow: visible;
}

    .canvas-card {
      flex: 1;
      min-height: 180px;
      background: white;
      border-radius: 14px;
      border: 1px solid #e5e7eb;
      padding: 8px 10px 10px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      overflow: hidden;
    }

      /* ì§ì ‘ ì“°ê¸° ì¹´ë“œ ìˆ¨ê¸°ê¸°(ìº”ë²„ìŠ¤ë¥¼ í•˜ë‚˜ì²˜ëŸ¼ ì‚¬ìš©) */
#freeCard {
  display: none;
}

      /* ê¸´ ê¸€ íƒ­ì¼ ë•Œë§Œ ìœ„ìª½ í•„ì‚¬ ì¹¸ ë†’ì´ í‚¤ìš°ê¸° */
body.long-mode #traceCard {
  min-height: 620px;  /* ì›í•˜ë©´ 500~600 ì‚¬ì´ë¡œ ìˆ«ì ì¡°ì ˆ ê°€ëŠ¥ */
}

      
    .canvas-header {
      font-size: 0.8rem;
      font-weight: 600;
      color: #374151;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .canvas-hint {
      font-size: 0.7rem;
      color: #9ca3af;
    }
    .canvas-wrap {
      flex: 1;
      border-radius: 10px;
      border: 1px dashed #e5e7eb;
      background: #f9fafb;
      overflow: hidden;
    }
    canvas {
      width: 100%;
      height: 100%;
      display: block;
      touch-action: none;
    }

    .bottom-bar {
      display: flex;
      justify-content: flex-end;
      margin-top: 4px;
    }
    .clear-btn {
      border-radius: 999px;
      border: none;
      padding: 6px 14px;
      font-size: 0.8rem;
      cursor: pointer;
      background: #e5e7eb;
      color: #374151;
    }

    .hidden {
      display: none !important;
    }

    /* ë°˜ì‘í˜• ì¡°ì •: ì•„ì´íŒ¨ë“œ / íƒœë¸”ë¦¿ì—ì„œ ì„¸ë¡œ ì—¬ë°± ì¤„ì´ê¸° */
    @media (max-height: 800px) {
      .canvas-card {
        min-height: 150px;
      }
    }
    @media (max-width: 900px) {
      .app-main {
        flex-direction: column;
      }
      .side-panel {
        width: 100%;
        max-width: none;
        border-right: none;
        border-bottom: 1px solid #e5e7eb;
        display: flex;
        flex-direction: column;
      }
      .letter-grid {
        grid-template-columns: repeat(6, minmax(0, 1fr));
      }
    }

        .difficulty-tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .diff-btn {
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      background: #f3f4f6;
      padding: 4px 10px;
      font-size: 0.75rem;
      cursor: pointer;
      color: #374151;
    }
    .diff-btn.active {
      border-color: #f97316;
      background: #fff7ed;
      color: #9a3412;
    }

    .longtext-item {
      border-radius: 10px;
      border: 1px solid #e5e7eb;
      background: #ffffff;
      padding: 6px 8px;
      cursor: pointer;
      font-size: 0.8rem;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .longtext-item-title {
      font-weight: 600;
      color: #111827;
    }
    .longtext-item-meta {
      font-size: 0.7rem;
      color: #6b7280;
    }
    .longtext-item.active {
      border-color: #f97316;
      box-shadow: 0 0 0 1px rgba(249,115,22,0.4);
    }

    .ghost-line {
  opacity: 0.12;
  font-size: 3.2rem;
  line-height: 1.8;
  direction: rtl;
  white-space: normal; /* ì¤„ë°”ê¿ˆ í—ˆìš© */
  margin-bottom: 20px;
}

      #ghostCanvas {
  white-space: normal;
  overflow-wrap: break-word;
  word-wrap: break-word;
  direction: rtl;
  text-align: right;
}

#ghostCanvas .ghost-line {
        font-size: 3rem;      /* ì „ì²´ í¬ê¸° â†“ */
        line-height: 1.4;     /* ì¤„ ê°„ê²© â†“ */
        word-break: keep-all;
        white-space: pre-line;
      }

.longtext-tag {
  font-size: 0.75rem;
  color: #9ca3af;
  margin-bottom: 2px;
}

/* ê³µí†µ: í•œêµ­ì–´/ì•„ëì–´ ë°•ìŠ¤ ê¸°ë³¸ ìŠ¤íƒ€ì¼ (ìµœëŒ€í•œ ì—¬ë°± ì¶•ì†Œ) */
.longtext-block-body {
  padding: 4px 0;
  border-radius: 0;
  line-height: 1.6;
  font-size: 0.9rem;
  white-space: pre-line;
}

/* ì•„ëì–´(ìœ„ìª½)ë§Œ íšŒìƒ‰ ë°•ìŠ¤ë¡œ, í•œêµ­ì–´ëŠ” ê·¸ëƒ¥ í…ìŠ¤íŠ¸ì²˜ëŸ¼ ë³´ì´ë„ë¡ */
.longtext-block-body.ar {
  background: #f5f5f5;
  padding: 8px 10px;
  border-radius: 8px;
  text-align: right;
  direction: rtl;
  font-family: "Scheherazade New", serif;
}

.lt-line {
  margin-bottom: 4px;
}

      /* ê¸´ ê¸€ íƒ­ì—ì„œ: ì—°í•œ ì•„ëì–´ í† ê¸€ì„ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ë°€ê¸° */
.selection-card.longtext-toolbar #longTextGuideToggleBtn {
  margin-left: auto;      /* ì—¬ê¸°ì„œ ì™¼ìª½ ê·¸ë£¹(ë°œìŒ/ë…¹ìŒ)ê³¼ ì˜¤ë¥¸ìª½ ê·¸ë£¹ì„ ë¶„ë¦¬ */
}

/* í˜ì´ì§€ ì´ë™ ë²„íŠ¼ì€ í† ê¸€ ë°”ë¡œ ì˜¤ë¥¸ìª½ì— ë¶™ë„ë¡ ì‚´ì§ ê°„ê²©ë§Œ */
.selection-card.longtext-toolbar #longTextPageControls {
  margin-left: 6px;
}



  </style>
</head>
<body>
  <header class="app-header">
    <div class="app-title">Arabic Practice Lab</div>
    <div class="tab-bar">
      <button class="tab-btn active" data-tab="letters">ììŒ</button>
      <button class="tab-btn" data-tab="vowels">ëª¨ìŒ</button>
      <button class="tab-btn" data-tab="words">ë‹¨ì–´</button>
      <button class="tab-btn" data-tab="sentences">ë¬¸ì¥</button>
      <button class="tab-btn" data-tab="longtext">ê¸´ ê¸€</button>
    </div>
  </header>

  <main class="app-main">
    <!-- ì™¼ìª½ íŒ¨ë„ -->
    <aside class="side-panel">
      <div id="panel-letters">
        <div class="side-title">ì•„ëì–´ ììŒ</div>
        <div class="side-sub">ììŒì„ ëˆŒëŸ¬ ëª¨ì–‘ê³¼ ë°œìŒì„ ì—°ìŠµí•´ ë³´ì„¸ìš”.</div>
        <div id="lettersList" class="letter-grid"></div>
      </div>

      <div id="panel-vowels" class="hidden">
        <div class="side-title">ëª¨ìŒ ê¸°í˜¸</div>
        <div class="side-sub">ì§§ì€ ëª¨ìŒê³¼ ê¸´ ëª¨ìŒì„ ì—°ìŠµí•´ ë³´ì„¸ìš”.</div>
        <div id="vowelsList" class="letter-grid"></div>
      </div>

      <div id="panel-words" class="hidden">
        <div class="side-title">ë‹¨ì–´ ì—°ìŠµ</div>
        <div class="side-sub">ì¹´í…Œê³ ë¦¬ì—ì„œ ë‹¨ì–´ë¥¼ ì„ íƒí•´ ë³´ì„¸ìš”.</div>
        <div style="display:flex; flex-wrap:wrap; gap:6px; margin-bottom:8px;">
          <button class="tab-btn" style="padding:4px 10px; font-size:0.75rem;" data-wordcat="colors">ìƒ‰ê¹”</button>
          <button class="tab-btn" style="padding:4px 10px; font-size:0.75rem;" data-wordcat="weather">ë‚ ì”¨</button>
          <button class="tab-btn" style="padding:4px 10px; font-size:0.75rem;" data-wordcat="fruits">ê³¼ì¼</button>
          <button class="tab-btn" style="padding:4px 10px; font-size:0.75rem;" data-wordcat="transport">êµí†µìˆ˜ë‹¨</button>
        </div>
        <div id="wordsList" class="letter-grid"></div>
      </div>

      <div id="panel-sentences" class="hidden">
        <div class="side-title">ë¬¸ì¥ ì—°ìŠµ</div>
        <div class="side-sub">ê¸°ë³¸ íšŒí™” ë¬¸ì¥ì„ ê³¨ë¼ ë”°ë¼ ì¨ ë³´ì„¸ìš”.</div>
        <div id="sentencesList" style="display:flex; flex-direction:column; gap:6px;"></div>
      </div>

            <div id="panel-longtext" class="hidden">
        <div class="side-title">ê¸´ ê¸€ ì—°ìŠµ</div>
        <div class="side-sub">ì§§ì€ ë™í™”ë‚˜ ì¼ìƒ ê¸€ì„ í•„ì‚¬í•´ ë³´ì„¸ìš”.</div>

        <!-- ë‚œì´ë„ ë²„íŠ¼ -->
        <div class="difficulty-tabs" style="margin-top:8px;">
          <button class="diff-btn active" data-level="beginner">ì´ˆê¸‰</button>
          <button class="diff-btn" data-level="intermediate">ì¤‘ê¸‰</button>
          <button class="diff-btn" data-level="advanced">ê³ ê¸‰</button>
        </div>

        <!-- ê¸´ ê¸€ ë¦¬ìŠ¤íŠ¸ -->
        <div id="longtextList" style="margin-top:10px; display:flex; flex-direction:column; gap:6px;"></div>
      </div>

    </aside>

    <!-- ì˜¤ë¥¸ìª½ íŒ¨ë„ -->
    <section class="content-panel">
      <!-- ì„ íƒ ì •ë³´ ì¹´ë“œ -->
            <div class="selection-card" id="selectionCard">
        <div class="selection-main">
          <div class="selection-top-line">
            <div class="selection-ar" id="selArabic">ì•„ëì–´ ì—°ìŠµ ì‚¬ì´íŠ¸</div>
            <div class="selection-type" id="selType">ì•ˆë‚´</div>
          </div>
          <div class="selection-extra" id="selExtra">
            <span>ì™¼ìª½ì—ì„œ ììŒÂ·ëª¨ìŒÂ·ë‹¨ì–´Â·ë¬¸ì¥ì„ ì„ íƒí•˜ë©´ ì´ê³³ì— ì •ë³´ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</span>
          </div>
          <div class="selection-forms hidden" id="selForms">
  <div class="form-title">ììŒ í˜•íƒœ ì„ íƒ</div>
  <div class="form-buttons">
    <button class="form-btn" data-form="isolated">ë‹¨ë…í˜•</button>
    <button class="form-btn" data-form="initial">ì–´ë‘í˜•</button>
    <button class="form-btn" data-form="medial">ì¤‘ê°„í˜•</button>
    <button class="form-btn" data-form="final">ì–´ë§í˜•</button>
  </div>
</div>


        </div>

        <!-- ì˜¤ë¥¸ìª½: ë°œìŒ ë“£ê¸° + ë…¹ìŒ ë²„íŠ¼ë“¤ -->
        <div class="selection-right">
          <button class="play-btn" id="playSelectionBtn">
            <span>ğŸ”Š</span> ë°œìŒ ë“£ê¸°
          </button>

          <div class="record-mini">
            <div class="record-mini-buttons">
              <button type="button" class="record-btn" id="recordStartBtn">â— ë…¹ìŒ</button>
              <button type="button" class="record-btn" id="recordStopBtn">â–  ì •ì§€</button>
              <button type="button" class="record-btn" id="recordPlayBtn">â–¶ ì¬ìƒ</button>
            </div>
            <div class="record-mini-status" id="recordStatus">ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤.</div>
          </div>
        </div>
                <!-- ğŸ”½ ìƒˆë¡œ ì¶”ê°€: ê¸´ ê¸€ ì „ìš© ì—°í•œ ì•„ëì–´ í† ê¸€ ë²„íŠ¼ -->
  <button id="longTextGuideToggleBtn" class="guide-toggle-btn" style="display:none;">
    ì—°í•œ ì•„ëì–´: ì¼œì§
  </button>
                <!-- ğŸ”½ ìƒˆë¡œ ì¶”ê°€: ê¸´ ê¸€ ë¬¸ì¥ ë„˜ê¸°ê¸° ì»¨íŠ¸ë¡¤ -->
<div id="longTextPageControls" class="longtext-page-controls" style="display:none;">
  <button id="longTextPrevBtn" class="page-btn">ì´ì „</button>
  <span id="longTextPageInfo" class="page-info">1 / 1</span>
  <button id="longTextNextBtn" class="page-btn">ë‹¤ìŒ</button>
</div>
      </div>

      
      

      <!-- ìº”ë²„ìŠ¤ ì˜ì—­ -->
      <div class="canvas-section">
        <div class="canvas-card" id="traceCard">
          <div class="canvas-header">
            <span>1. ë”°ë¼ ì“°ê¸°</span>
            <span class="canvas-hint">ì—°í•œ ê¸€ìë¥¼ ë”°ë¼ ê·¸ë ¤ ë³´ì„¸ìš”.</span>
          </div>
          <div class="canvas-wrap">
            <canvas id="traceCanvas"></canvas>
          </div>
        </div>

        <div class="canvas-card" id="freeCard">
          <div class="canvas-header">
            <span>2. ì§ì ‘ ì“°ê¸°</span>
            <span class="canvas-hint">ììœ ë¡­ê²Œ ì—°ìŠµí•´ ë³´ì„¸ìš”.</span>
          </div>
          <div class="canvas-wrap">
            <canvas id="freeCanvas"></canvas>
          </div>
          <div class="bottom-bar">
            <button class="clear-btn" id="clearBtn">ëª¨ë‘ ì§€ìš°ê¸°</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script>
    // ======================
    // ë°ì´í„° ì •ì˜
    // ======================
    const consonants = [
      { char: "Ø§", name: "alif", sound: "a / Ä", type: "ììŒ", forms: { isolated: "Ø§", initial: "Ø§", medial: "Ù€Ø§", final: "Ù€Ø§" } },
      { char: "Ø¨", name: "bÄÊ¼", sound: "b", type: "ììŒ", forms: { isolated: "Ø¨", initial: "Ø¨Ù€", medial: "Ù€Ø¨Ù€", final: "Ù€Ø¨" } },
      { char: "Øª", name: "tÄÊ¼", sound: "t", type: "ììŒ", forms: { isolated: "Øª", initial: "ØªÙ€", medial: "Ù€ØªÙ€", final: "Ù€Øª" } },
      { char: "Ø«", name: "thÄÊ¼", sound: "th", type: "ììŒ", forms: { isolated: "Ø«", initial: "Ø«Ù€", medial: "Ù€Ø«Ù€", final: "Ù€Ø«" } },
      { char: "Ø¬", name: "jÄ«m", sound: "j", type: "ììŒ", forms: { isolated: "Ø¬", initial: "Ø¬Ù€", medial: "Ù€Ø¬Ù€", final: "Ù€Ø¬" } },
      { char: "Ø­", name: "á¸¥ÄÊ¼", sound: "á¸¥", type: "ììŒ", forms: { isolated: "Ø­", initial: "Ø­Ù€", medial: "Ù€Ø­Ù€", final: "Ù€Ø­" } },
      { char: "Ø®", name: "khÄÊ¼", sound: "kh", type: "ììŒ", forms: { isolated: "Ø®", initial: "Ø®Ù€", medial: "Ù€Ø®Ù€", final: "Ù€Ø®" } },
      { char: "Ø¯", name: "dÄl", sound: "d", type: "ììŒ", forms: { isolated: "Ø¯", initial: "Ø¯", medial: "Ù€Ø¯", final: "Ù€Ø¯" } },
      { char: "Ø°", name: "dhÄl", sound: "dh", type: "ììŒ", forms: { isolated: "Ø°", initial: "Ø°", medial: "Ù€Ø°", final: "Ù€Ø°" } },
      { char: "Ø±", name: "rÄÊ¼", sound: "r", type: "ììŒ", forms: { isolated: "Ø±", initial: "Ø±", medial: "Ù€Ø±", final: "Ù€Ø±" } },
      { char: "Ø²", name: "zÄy", sound: "z", type: "ììŒ", forms: { isolated: "Ø²", initial: "Ø²", medial: "Ù€Ø²", final: "Ù€Ø²" } },
      { char: "Ø³", name: "sÄ«n", sound: "s", type: "ììŒ", forms: { isolated: "Ø³", initial: "Ø³Ù€", medial: "Ù€Ø³Ù€", final: "Ù€Ø³" } },
      { char: "Ø´", name: "shÄ«n", sound: "sh", type: "ììŒ", forms: { isolated: "Ø´", initial: "Ø´Ù€", medial: "Ù€Ø´Ù€", final: "Ù€Ø´" } },
      { char: "Øµ", name: "á¹£Äd", sound: "á¹£", type: "ììŒ", forms: { isolated: "Øµ", initial: "ØµÙ€", medial: "Ù€ØµÙ€", final: "Ù€Øµ" } },
      { char: "Ø¶", name: "á¸Äd", sound: "á¸", type: "ììŒ", forms: { isolated: "Ø¶", initial: "Ø¶Ù€", medial: "Ù€Ø¶Ù€", final: "Ù€Ø¶" } },
      { char: "Ø·", name: "á¹­ÄÊ¼", sound: "á¹­", type: "ììŒ", forms: { isolated: "Ø·", initial: "Ø·Ù€", medial: "Ù€Ø·Ù€", final: "Ù€Ø·" } },
      { char: "Ø¸", name: "áº“ÄÊ¼", sound: "áº“", type: "ììŒ", forms: { isolated: "Ø¸", initial: "Ø¸Ù€", medial: "Ù€Ø¸Ù€", final: "Ù€Ø¸" } },
      { char: "Ø¹", name: "Ê¿ayn", sound: "Ê¿", type: "ììŒ", forms: { isolated: "Ø¹", initial: "Ø¹Ù€", medial: "Ù€Ø¹Ù€", final: "Ù€Ø¹" } },
      { char: "Øº", name: "ghayn", sound: "gh", type: "ììŒ", forms: { isolated: "Øº", initial: "ØºÙ€", medial: "Ù€ØºÙ€", final: "Ù€Øº" } },
      { char: "Ù", name: "fÄÊ¼", sound: "f", type: "ììŒ", forms: { isolated: "Ù", initial: "ÙÙ€", medial: "Ù€ÙÙ€", final: "Ù€Ù" } },
      { char: "Ù‚", name: "qÄf", sound: "q", type: "ììŒ", forms: { isolated: "Ù‚", initial: "Ù‚Ù€", medial: "Ù€Ù‚Ù€", final: "Ù€Ù‚" } },
      { char: "Ùƒ", name: "kÄf", sound: "k", type: "ììŒ", forms: { isolated: "Ùƒ", initial: "ÙƒÙ€", medial: "Ù€ÙƒÙ€", final: "Ù€Ùƒ" } },
      { char: "Ù„", name: "lÄm", sound: "l", type: "ììŒ", forms: { isolated: "Ù„", initial: "Ù„Ù€", medial: "Ù€Ù„Ù€", final: "Ù€Ù„" } },
      { char: "Ù…", name: "mÄ«m", sound: "m", type: "ììŒ", forms: { isolated: "Ù…", initial: "Ù…Ù€", medial: "Ù€Ù…Ù€", final: "Ù€Ù…" } },
      { char: "Ù†", name: "nÅ«n", sound: "n", type: "ììŒ", forms: { isolated: "Ù†", initial: "Ù†Ù€", medial: "Ù€Ù†Ù€", final: "Ù€Ù†" } },
      { char: "Ù‡", name: "hÄÊ¼", sound: "h", type: "ììŒ", forms: { isolated: "Ù‡", initial: "Ù‡Ù€", medial: "Ù€Ù‡Ù€", final: "Ù€Ù‡" } },
      { char: "Ùˆ", name: "wÄw", sound: "w", type: "ììŒ", forms: { isolated: "Ùˆ", initial: "Ùˆ", medial: "Ù€Ùˆ", final: "Ù€Ùˆ" } },
      { char: "ÙŠ", name: "yÄÊ¼", sound: "y", type: "ììŒ", forms: { isolated: "ÙŠ", initial: "ÙŠÙ€", medial: "Ù€ÙŠÙ€", final: "Ù€ÙŠ" } },
    ];

    // ììŒ í˜•íƒœ ì •ë³´
const arabicForms = {
  "Ø§": { isolated: "Ø§", initial: "Ø§", medial: "Ù€Ø§", final: "Ù€Ø§" },
  "Ø¨": { isolated: "Ø¨", initial: "Ø¨Ù€", medial: "Ù€Ø¨Ù€", final: "Ù€Ø¨" },
  "Øª": { isolated: "Øª", initial: "ØªÙ€", medial: "Ù€ØªÙ€", final: "Ù€Øª" },
  "Ø«": { isolated: "Ø«", initial: "Ø«Ù€", medial: "Ù€Ø«Ù€", final: "Ù€Ø«" },
  "Ø¬": { isolated: "Ø¬", initial: "Ø¬Ù€", medial: "Ù€Ø¬Ù€", final: "Ù€Ø¬" },
  "Ø­": { isolated: "Ø­", initial: "Ø­Ù€", medial: "Ù€Ø­Ù€", final: "Ù€Ø­" },
  "Ø®": { isolated: "Ø®", initial: "Ø®Ù€", medial: "Ù€Ø®Ù€", final: "Ù€Ø®" },
  "Ø¯": { isolated: "Ø¯", initial: "Ø¯", medial: "Ù€Ø¯", final: "Ù€Ø¯" },
  "Ø°": { isolated: "Ø°", initial: "Ø°", medial: "Ù€Ø°", final: "Ù€Ø°" },
  "Ø±": { isolated: "Ø±", initial: "Ø±", medial: "Ù€Ø±", final: "Ù€Ø±" },
  "Ø²": { isolated: "Ø²", initial: "Ø²", medial: "Ù€Ø²", final: "Ù€Ø²" },
  "Ø³": { isolated: "Ø³", initial: "Ø³Ù€", medial: "Ù€Ø³Ù€", final: "Ù€Ø³" },
  "Ø´": { isolated: "Ø´", initial: "Ø´Ù€", medial: "Ù€Ø´Ù€", final: "Ù€Ø´" },
  "Øµ": { isolated: "Øµ", initial: "ØµÙ€", medial: "Ù€ØµÙ€", final: "Ù€Øµ" },
  "Ø¶": { isolated: "Ø¶", initial: "Ø¶Ù€", medial: "Ù€Ø¶Ù€", final: "Ù€Ø¶" },
  "Ø·": { isolated: "Ø·", initial: "Ø·Ù€", medial: "Ù€Ø·Ù€", final: "Ù€Ø·" },
  "Ø¸": { isolated: "Ø¸", initial: "Ø¸Ù€", medial: "Ù€Ø¸Ù€", final: "Ù€Ø¸" },
};


    const vowels = [
      { char: "Ù", name: "fatá¸¥a", sound: "a", type: "ëª¨ìŒ" },
      { char: "Ù", name: "kasra", sound: "i", type: "ëª¨ìŒ" },
      { char: "Ù", name: "á¸amma", sound: "u", type: "ëª¨ìŒ" },
      { char: "Ù‹", name: "tanwÄ«n fatá¸¥", sound: "an", type: "ëª¨ìŒ" },
      { char: "Ù", name: "tanwÄ«n kasr", sound: "in", type: "ëª¨ìŒ" },
      { char: "ÙŒ", name: "tanwÄ«n á¸amm", sound: "un", type: "ëª¨ìŒ" }
    ];

    const wordCategories = {
      colors: [
        { arabic: "Ù„ÙÙˆÙ’Ù†", pron: "lawn", meaning: "ìƒ‰" },
  { arabic: "Ø£ÙØ­Ù’Ù…ÙØ±Ù", pron: "aá¸¥mar", meaning: "ë¹¨ê°„ìƒ‰" },
  { arabic: "Ø¨ÙØ±Ù’ØªÙÙ‚ÙØ§Ù„ÙÙŠÙ‘", pron: "burtuqÄlÄ«", meaning: "ì£¼í™©ìƒ‰" },
  { arabic: "Ø£ÙØµÙ’ÙÙØ±Ù", pron: "aá¹£far", meaning: "ë…¸ë€ìƒ‰" },
  { arabic: "Ø£ÙØ®Ù’Ø¶ÙØ±Ù", pron: "aá¸«á¸ar", meaning: "ì´ˆë¡ìƒ‰" },
  { arabic: "Ø£ÙØ²Ù’Ø±ÙÙ‚Ù", pron: "azraq", meaning: "íŒŒë€ìƒ‰" },
  { arabic: "Ù†ÙÙŠÙ„ÙÙŠÙ‘", pron: "nÄ«lÄ«", meaning: "ë‚¨ìƒ‰" },
  { arabic: "Ø¨ÙÙ†ÙÙÙ’Ø³ÙØ¬ÙÙŠÙ‘", pron: "banafsajÄ«", meaning: "ë³´ë¼ìƒ‰" },
  { arabic: "Ø¨ÙÙ†Ù‘ÙÙŠÙ‘", pron: "bunnÄ«", meaning: "ê°ˆìƒ‰" },
  { arabic: "Ø£ÙØ³Ù’ÙˆÙØ¯Ù", pron: "aswad", meaning: "ê²€ì€ìƒ‰" },
  { arabic: "Ø£ÙØ¨Ù’ÙŠÙØ¶Ù", pron: "abyaá¸", meaning: "í•˜ì–€ìƒ‰" },
  { arabic: "Ø±ÙÙ…ÙØ§Ø¯ÙÙŠÙ‘", pron: "ramÄdÄ«", meaning: "íšŒìƒ‰" },
  { arabic: "ÙˆÙØ±Ù’Ø¯ÙÙŠÙ‘", pron: "wardÄ«", meaning: "í•‘í¬ìƒ‰" },
  { arabic: "Ø°ÙÙ‡ÙØ¨ÙÙŠÙ‘", pron: "dhahabÄ«", meaning: "ê¸ˆìƒ‰" },
  { arabic: "ÙÙØ¶Ù‘ÙÙŠÙ‘", pron: "fiá¸á¸Ä«", meaning: "ì€ìƒ‰" }

      ],
    
      
      weather: [
        { arabic: "Ø§Ù„Ø·Ù‘ÙÙ‚Ù’Ø³", pron: "aá¹­-á¹­aqs", meaning: "ë‚ ì”¨" },
        { arabic: "Ù…ÙØ·ÙØ±ÙŒ", pron: "maá¹­ar", meaning: "ë¹„" },
  { arabic: "Ø«ÙÙ„Ù’Ø¬ÙŒ", pron: "thalj", meaning: "ëˆˆ(snow)" },
  { arabic: "Ø±ÙÙŠØ­ÙŒ", pron: "rÄ«á¸¥", meaning: "ë°”ëŒ" },
  { arabic: "Ø¬ÙÙˆÙ‘ÙŒ Ø­ÙØ§Ø±Ù‘ÙŒ", pron: "jaww á¸¥Ärr", meaning: "ë”ìš´ ë‚ ì”¨" },
  { arabic: "Ø¬ÙÙˆÙ‘ÙŒ Ø¨ÙØ§Ø±ÙØ¯ÙŒ", pron: "jaww bÄrid", meaning: "ì¶”ìš´ ë‚ ì”¨" },
  { arabic: "ØºÙØ§Ø¦ÙÙ…ÙŒ", pron: "Ä¡Ä'im", meaning: "íë¦¼ / êµ¬ë¦„ ë‚€" },
  { arabic: "Ù…ÙØ´Ù’Ù…ÙØ³ÙŒ", pron: "mushmis", meaning: "ë§‘ìŒ" },
  { arabic: "Ø¹Ø§ØµÙÙ", pron: "Ê¿Äá¹£if", meaning: "í­í’ìš°" },
  { arabic: "Ø¶ÙØ¨ÙØ§Ø¨ÙŒ", pron: "á¸abÄb", meaning: "ì•ˆê°œ" },
  { arabic: "Ø±ÙØ·ÙØ¨ÙŒ", pron: "raá¹­ib", meaning: "ìŠµí•¨" },
  { arabic: "Ø¬ÙØ§ÙÙ‘ÙŒ", pron: "jÄff", meaning: "ê±´ì¡°í•¨" },
  { arabic: "Ø±ÙØ¹Ù’Ø¯ÙŒ", pron: "raÊ¿d", meaning: "ì²œë‘¥" },
  { arabic: "Ø¨ÙØ±Ù’Ù‚ÙŒ", pron: "barq", meaning: "ë²ˆê°œ" },
  { arabic: "Ø¹Ø§ØµÙÙÙØ©ÙŒ Ø±ÙÙ…Ù’Ù„ÙÙŠÙ‘ÙØ©ÙŒ", pron: "Ê¿Äá¹£ifah ramliyyah", meaning: "ëª¨ë˜í­í’" },
  { arabic: "Ø¥ÙØ¹Ù’ØµÙØ§Ø±", pron: "iÊ¿á¹£Är", meaning: "íƒœí’" }
      ],
     
    
    fruits: [
         { arabic: "ÙÙØ§ÙƒÙÙ‡ÙØ©ÙŒ", pron: "fÄkihah", meaning: "ê³¼ì¼" },
  { arabic: "ØªÙÙÙÙ‘Ø§Ø­ÙØ©ÙŒ", pron: "tuffÄá¸¥a", meaning: "ì‚¬ê³¼" },
  { arabic: "Ù…ÙÙˆÙ’Ø²ÙØ©ÙŒ", pron: "mawza", meaning: "ë°”ë‚˜ë‚˜" },
  { arabic: "Ø¹ÙÙ†ÙØ¨ÙŒ", pron: "Ê¿inab", meaning: "í¬ë„" },
  { arabic: "Ø¨ÙØ±Ù’ØªÙÙ‚ÙØ§Ù„ÙØ©ÙŒ", pron: "burtuqÄla", meaning: "ì˜¤ë Œì§€" },
  { arabic: "ÙÙØ±ÙØ§ÙˆÙ’Ù„ÙØ©ÙŒ", pron: "farÄwlah", meaning: "ë”¸ê¸°" },
  { arabic: "Ø¨ÙØ·ÙÙ‘ÙŠØ®ÙØ©ÙŒ", pron: "biá¹­á¹­Ä«á¸«a", meaning: "ìˆ˜ë°•" },
  { arabic: "ÙƒÙÙ…ÙÙ‘Ø«Ù’Ø±ÙÙ‰", pron: "kummathrÄ", meaning: "ë°°" },
  { arabic: "Ù…ÙØ§Ù†Ù’Ø¬ÙØ§", pron: "mÄnjÄ", meaning: "ë§ê³ " },
  { arabic: "Ø£ÙÙ†ÙØ§Ù†ÙØ§Ø³", pron: "anÄnÄs", meaning: "íŒŒì¸ì• í”Œ" },
  { arabic: "ÙƒÙØ±ÙØ²ÙŒ", pron: "karaz", meaning: "ì²´ë¦¬" },
  { arabic: "Ø±ÙÙ…ÙÙ‘Ø§Ù†ÙŒ", pron: "rummÄn", meaning: "ì„ë¥˜" },
  { arabic: "ØªÙÙŠÙ†ÙŒ", pron: "tÄ«n", meaning: "ë¬´í™”ê³¼" },
  { arabic: "Ø®ÙÙˆÙ’Ø®ÙŒ", pron: "khawkh", meaning: "ë³µìˆ­ì•„" },
  { arabic: "Ù„ÙÙŠÙ’Ù…ÙÙˆÙ†ÙŒ", pron: "laymÅ«n", meaning: "ë ˆëª¬" }

      ],

      
      transport: [
        { arabic: "ÙˆÙØ³ÙÙŠÙ„ÙØ©Ù Ù†ÙÙ‚Ù’Ù„Ù", pron: "wasÄ«lat naql", meaning: "êµí†µìˆ˜ë‹¨" },
  { arabic: "Ø³ÙÙŠÙÙ‘Ø§Ø±ÙØ©ÙŒ", pron: "sayyÄra", meaning: "ìë™ì°¨" },
  { arabic: "Ø­ÙØ§ÙÙÙ„ÙØ©ÙŒ", pron: "á¸¥Äfila", meaning: "ë²„ìŠ¤" },
  { arabic: "Ù‚ÙØ·ÙØ§Ø±ÙŒ", pron: "qiá¹­Är", meaning: "ê¸°ì°¨" },
  { arabic: "Ø·ÙØ§Ø¦ÙØ±ÙØ©ÙŒ", pron: "á¹­ÄÊ¾ira", meaning: "ë¹„í–‰ê¸°" },
  { arabic: "Ø¯ÙØ±ÙÙ‘Ø§Ø¬ÙØ©ÙŒ", pron: "darrÄja", meaning: "ìì „ê±°" },
  { arabic: "Ø¯ÙØ±ÙÙ‘Ø§Ø¬ÙØ©ÙŒ Ù†ÙØ§Ø±ÙÙŠÙÙ‘Ø©ÙŒ", pron: "darrÄja nÄriyya", meaning: "ì˜¤í† ë°”ì´" },
  { arabic: "Ø³ÙÙÙÙŠÙ†ÙØ©ÙŒ", pron: "safÄ«na", meaning: "ë°° / ì„ ë°•" },
  { arabic: "Ù‚ÙØ§Ø±ÙØ¨ÙŒ", pron: "qÄrib", meaning: "ë³´íŠ¸" },
  { arabic: "Ù…ÙØªÙ’Ø±ÙÙˆ / Ù‚ÙØ·ÙØ§Ø±ÙŒ Ø£ÙÙ†Ù’ÙÙØ§Ù‚", pron: "mitrÅ« / qiá¹­Är anfÄq", meaning: "ì§€í•˜ì² " },
  { arabic: "ØªÙÙƒÙ’Ø³ÙÙŠ", pron: "taksÄ«", meaning: "íƒì‹œ" },
  { arabic: "Ø´ÙØ§Ø­ÙÙ†ÙØ©ÙŒ", pron: "shÄá¸¥ina", meaning: "íŠ¸ëŸ­" },
  { arabic: "Ù‚ÙØ·ÙØ§Ø±ÙŒ Ø³ÙØ±ÙÙŠØ¹ÙŒ", pron: "quá¹­Är sarÄ«Ê¿", meaning: "ê³ ì†ì—´ì°¨" },
  { arabic: "Ù‚ÙØ·ÙØ§Ø±Ù Ø§Ù„Ø±ÙÙ‘ÙƒÙÙ‘Ø§Ø¨", pron: "qiá¹­Äru r-rukkÄb", meaning: "ì—¬ê°ì—´ì°¨" },
  { arabic: "Ø­ÙØ§ÙÙÙ„ÙØ©ÙŒ ØµÙØºÙÙŠØ±ÙØ©ÙŒ", pron: "á¸¥Äfila á¹£aghÄ«ra", meaning: "ìŠ¹í•©ì°¨" }
      ]
    };

    const sentences = [
      {
        arabic: "Ø§Ù„Ø³Ù‘ÙÙ„ÙØ§Ù…Ù Ø¹ÙÙ„ÙÙŠÙ’ÙƒÙÙ…Ù’.",
        pron: "as-salÄmu Ê¿alaykum",
        meaning: "í‰ì•ˆì´ ìˆê¸°ë¥¼(ì•ˆë¶€ ì¸ì‚¬)."
      },
      {
        arabic: "ÙƒÙÙŠÙ’ÙÙ Ø­ÙØ§Ù„ÙÙƒÙØŸ",
        pron: "kayfa á¸¥Äluka?",
        meaning: "ì˜ ì§€ë‚´?"
      },
      {
        arabic: "Ø£ÙÙ†ÙØ§ Ø·ÙØ§Ù„ÙØ¨ÙØ©ÙŒ ÙÙÙŠ Ø§Ù„Ù’Ø¬ÙØ§Ù…ÙØ¹ÙØ©Ù.",
        pron: "anÄ á¹­Älibatun fÄ« al-jÄmiÊ¿a",
        meaning: "ë‚˜ëŠ” ëŒ€í•™êµ í•™ìƒì´ì•¼."
      }
    ];
 // ê¸´ ê¸€ ë°ì´í„° (ì´ˆê¸‰ ì˜ˆì‹œ 1í¸)
    const longTexts = [
      {
        id: "duck_beginner_1",
        level: "beginner",
        title: "ì˜¤ë¦¬ ì´ì•¼ê¸° 1 â€“ ìœ„ì‚¼",
        tag: "ì¼ìƒ ë™í™” Â· ì´ˆê¸‰",
       arabic: [
      "Ø°Ø§ØªÙ Ù…ÙØ±Ù‘ÙØ©Ù ÙƒØ§Ù†ÙØªÙ’ Ù‡ÙÙ†Ø§ÙƒÙ Ø¨ÙØ·Ù‘ÙØ©ÙŒ ØµÙØºÙŠØ±ÙØ©ÙŒ ØªÙØ¹ÙŠØ´Ù Ø¹ÙÙ†Ø¯Ù Ø§Ù„Ø¨ÙØ­ÙÙŠÙ’Ø±ÙØ©Ù.",
      "ÙƒØ§Ù†Ù Ø§Ø³Ù…ÙÙ‡Ø§ ÙˆÙØ³Ø§Ù…ØŒ ÙˆÙÙƒØ§Ù†ÙØªÙ’ Ù…ÙØ¨Ù’ØªÙÙ‡ÙØ¬ÙØ©Ù‹ Ø¯Ø§Ø¦ÙÙ…Ù‹Ø§.",
      "ÙƒÙÙ„Ù‘Ù ØµÙØ¨Ø§Ø­Ù ØªÙØ³Ù’ØªÙÙŠÙ’Ù‚ÙØ¸Ù Ù…ÙØ¨ÙÙƒÙ‘ÙØ±Ù‹Ø§ ÙˆÙØªÙØ°Ù’Ù‡ÙØ¨Ù Ø¥ÙÙ„Ù‰ Ø§Ù„Ù…Ø§Ø¡Ù.",
      "ØªÙØ³Ù’Ø¨ÙØ­Ù ÙÙŠ Ø§Ù„Ø¨ÙØ­ÙÙŠÙ’Ø±ÙØ©Ù ÙˆÙØªÙÙ„Ù’Ø¹ÙØ¨Ù Ù…ÙØ¹Ù Ø§Ù„Ø£ÙØ³Ù’Ù…Ø§ÙƒÙ Ø§Ù„ØµÙ‘ÙØºÙŠØ±ÙØ©Ù.",
      "Ø¨ÙØ¹Ù’Ø¯Ù Ø§Ù„Ø³Ù‘ÙØ¨Ø§Ø­ÙØ©Ù ØªÙØ¬Ù’Ù„ÙØ³Ù ØªÙØ­Ù’ØªÙ Ø´ÙØ¬ÙØ±ÙØ©Ù ÙƒÙØ¨ÙŠØ±ÙØ©Ù Ù„ÙØªÙØ³Ù’ØªÙØ±ÙŠØ­Ù.",
      "ÙÙŠ ÙŠÙÙˆÙ…Ù Ù…ÙÙ†Ù Ø§Ù„Ø£ÙÙŠÙ‘Ø§Ù…Ù Ù‚Ø§Ø¨ÙÙ„ÙØªÙ’ Ø¨ÙØ·Ù‘ÙØ©Ù‹ Ø£ÙØ®Ù’Ø±Ù‰ ÙˆÙØ£ÙØµÙ’Ø¨ÙØ­ÙØªØ§ ØµÙØ¯ÙŠÙ‚ÙØªÙÙŠÙ’Ù†Ù.",
      "ÙƒØ§Ù†ÙØªØ§ ØªÙØ³Ù’Ø¨ÙØ­Ø§Ù†Ù ÙˆÙØªÙÙ„Ù’Ø¹ÙØ¨Ø§Ù†Ù Ù…ÙØ¹Ù‹Ø§ ÙƒÙÙ„Ù‘Ù ÙŠÙÙˆÙ…Ù.",
      "ÙƒØ§Ù†ÙØªÙ’ ÙˆÙØ³Ø§Ù… ØªÙØ´Ù’ÙƒÙØ±Ù Ø§Ù„Ù„Ù‡Ù Ø¯Ø§Ø¦ÙÙ…Ù‹Ø§ Ø¹ÙÙ„Ù‰ Ù‡Ø°ÙÙ‡Ù Ø§Ù„Ø­ÙÙŠØ§Ø©Ù Ø§Ù„Ø¨ÙØ³ÙŠØ·ÙØ©Ù Ø§Ù„Ø³Ù‘ÙØ¹ÙŠØ¯ÙØ©Ù."
    ].join("\n"),
    korean: [
      "ì˜›ë‚ ì— ì‘ì€ ì˜¤ë¦¬ í•œ ë§ˆë¦¬ê°€ í˜¸ìˆ«ê°€ì— ì‚´ê³  ìˆì—ˆì–´ìš”.",
      "ê·¸ ì˜¤ë¦¬ì˜ ì´ë¦„ì€ ìœ„ì‚¼ì´ì—ˆê³ , í•­ìƒ ëª…ë‘í–ˆì–´ìš”.",
      "ë§¤ì¼ ì•„ì¹¨ ì¼ì° ì¼ì–´ë‚˜ì„œ ë¬¼ê°€ë¡œ ê°”ì–´ìš”.",
      "í˜¸ìˆ˜ì—ì„œ í—¤ì—„ì¹˜ë©° ì‘ì€ ë¬¼ê³ ê¸°ë“¤ê³¼ ë†€ì•˜ì–´ìš”.",
      "ìˆ˜ì˜ì„ ë§ˆì¹œ í›„ì—ëŠ” í° ë‚˜ë¬´ ì•„ë˜ì— ì•‰ì•„ ì‰¬ì—ˆì–´ìš”.",
      "ì–´ëŠ ë‚  ë‹¤ë¥¸ ì˜¤ë¦¬ë¥¼ ë§Œë‚˜ ë‘˜ì€ ì¹œêµ¬ê°€ ë˜ì—ˆì–´ìš”.",
      "ë‘ ì˜¤ë¦¬ëŠ” ë§¤ì¼ í•¨ê»˜ í—¤ì—„ì¹˜ê³  ë†€ì•˜ì–´ìš”.",
      "ìœ„ì‚¼ì€ ì´ëŸ° ë‹¨ìˆœí•˜ì§€ë§Œ í–‰ë³µí•œ ì‚¶ì— í•­ìƒ ê°ì‚¬í–ˆì–´ìš”."
    ].join("\n")
      }
    ];
    

    // ======================
    // ìƒíƒœ ê´€ë¦¬
    // ======================
    let currentTab = "letters";
    let currentSelection = null; // { type, arabic, meaning, pron, forms }
      let longTextGuideEnabled = true; // ê¸´ ê¸€ì—ì„œ ì—°í•œ ì•„ëì–´ ON/OFF ìƒíƒœ
      let longTextSentences = [];
let longTextPageIndex = 0;
const LONG_TEXT_PAGE_SIZE = 3;  // í•œ ë²ˆì— 3ë¬¸ì¥

    // ======================
    // DOM ì°¸ì¡°
    // ======================
    const tabButtons = document.querySelectorAll(".tab-btn[data-tab]");
    const panelLetters = document.getElementById("panel-letters");
    const panelVowels = document.getElementById("panel-vowels");
    const panelWords = document.getElementById("panel-words");
    const panelSentences = document.getElementById("panel-sentences");
    const panelLongtext = document.getElementById("panel-longtext");

    const selectionCard = document.getElementById("selectionCard");
    const selectionRight = document.querySelector(".selection-right");
    const selArabic = document.getElementById("selArabic");
    const selType = document.getElementById("selType");
    const selExtra = document.getElementById("selExtra");
    const selForms = document.getElementById("selForms");
    const playSelectionBtn = document.getElementById("playSelectionBtn");
      const longTextGuideToggleBtn = document.getElementById("longTextGuideToggleBtn");
      const longTextPageControls = document.getElementById("longTextPageControls");
const longTextPrevBtn = document.getElementById("longTextPrevBtn");
const longTextNextBtn = document.getElementById("longTextNextBtn");
const longTextPageInfo = document.getElementById("longTextPageInfo");
        // ì—°í•œ ì•„ëì–´ ON/OFF ë²„íŠ¼ ì´ë²¤íŠ¸ (ê¸´ ê¸€ + ì¼ë°˜ íƒ­ ê³µí†µ)
  if (longTextGuideToggleBtn) {
    longTextGuideToggleBtn.addEventListener("click", () => {
      if (!currentSelection) return;

      // í† ê¸€ ìƒíƒœ ì „í™˜
      longTextGuideEnabled = !longTextGuideEnabled;
      longTextGuideToggleBtn.textContent = longTextGuideEnabled
        ? "ì—°í•œ ì•„ëì–´: ì¼œì§"
        : "ì—°í•œ ì•„ëì–´: êº¼ì§";

      // OFFë©´ ê°€ì´ë“œë§Œ ì§€ì›€
      if (!longTextGuideEnabled) {
        updateTraceGuide("");
        return;
      }

      // ONì´ë©´ í˜„ì¬ ì„ íƒì— ë§ì¶° ë‹¤ì‹œ ê·¸ë¦¼
      if (currentSelection.type === "ê¸´ ê¸€" && currentSelection.longTextArabic) {
        // ê¸´ ê¸€: í˜„ì¬ ì„ íƒëœ ê¸´ ê¸€ì˜ ì•„ëì–´ ë¬¸ì¥ì„ ë‹¤ì‹œ ì„¸íŒ…
        prepareLongTextPages(currentSelection.longTextArabic);
      } else if (currentSelection.arabic) {
        // ììŒ/ëª¨ìŒ/ë‹¨ì–´/ë¬¸ì¥: ì„ íƒëœ ì•„ëì–´ë¥¼ ë‹¤ì‹œ ê°€ì´ë“œì— í‘œì‹œ
        updateTraceGuide(currentSelection.arabic);
      }
    });
  }

      


        const recordCard = document.getElementById("recordCard");
    const recordStartBtn = document.getElementById("recordStartBtn");
    const recordStopBtn = document.getElementById("recordStopBtn");
    const recordPlayBtn = document.getElementById("recordPlayBtn");
    const recordStatus = document.getElementById("recordStatus");


    const lettersList = document.getElementById("lettersList");
    const vowelsList = document.getElementById("vowelsList");
    const wordsList = document.getElementById("wordsList");
    const sentencesList = document.getElementById("sentencesList");
    const longtextList = document.getElementById("longtextList");

      const diffButtons = document.querySelectorAll(".diff-btn");

diffButtons.forEach(btn => {
  btn.addEventListener("click", () => {
    const level = btn.dataset.level;
    if (!level) return;

    diffButtons.forEach(b => b.classList.remove("active"));
    btn.classList.add("active");

    currentLongLevel = level;
    renderLongTexts();

    // ê¸´ ê¸€ ë‚œì´ë„ ë°”ê¾¸ë©´ ì„ íƒ ì •ë³´ ì´ˆê¸°í™”
    renderSelectionInfo(null);
  });
});

    const traceCanvas = document.getElementById("traceCanvas");
    const freeCanvas = document.getElementById("freeCanvas");
    const clearBtn = document.getElementById("clearBtn");
      const traceCard = document.getElementById("traceCard");
const freeCard = document.getElementById("freeCard");
      // ğŸ”¹ freeCard ì•ˆì— ìˆë˜ bottom-bar(ëª¨ë‘ ì§€ìš°ê¸° ë²„íŠ¼)ë¥¼ traceCardë¡œ ì´ë™
if (traceCard && freeCard) {
  const bottomBar = freeCard.querySelector(".bottom-bar");
  if (bottomBar) {
    traceCard.appendChild(bottomBar);
  }
}
      // ğŸ”¹ í—¤ë” ë¬¸êµ¬ë¥¼ 'ë”°ë¼ ì“°ê¸° & ì§ì ‘ ì“°ê¸°'ë¡œ ë³€ê²½ (ì„ íƒ)
if (traceCard) {
  const titleSpan = traceCard.querySelector(".canvas-header span");
  if (titleSpan) {
    titleSpan.textContent = "ë”°ë¼ ì“°ê¸° & ì§ì ‘ ì“°ê¸°";
  }
}



    let traceCtx, freeCtx;
    let traceDrawing = false;
    let freeDrawing = false;
    let traceGuideText = "";

    

    // ======================
    // íƒ­ ì „í™˜
    // ======================
    function setTab(tab) {
  currentTab = tab;
  tabButtons.forEach(btn => {
    btn.classList.toggle("active", btn.dataset.tab === tab);
  });

  panelLetters.classList.toggle("hidden", tab !== "letters");
  panelVowels.classList.toggle("hidden", tab !== "vowels");
  panelWords.classList.toggle("hidden", tab !== "words");
  panelSentences.classList.toggle("hidden", tab !== "sentences");

          panelLongtext.classList.toggle("hidden", tab !== "longtext");

  // ğŸ”¹ ê¸´ ê¸€ íƒ­ì¼ ë•Œ: ìƒë‹¨ ì¹´ë“œ íˆ´ë°”(ë°œìŒ/ë…¹ìŒ/ì—°í•œ ì•„ëì–´/ì´ì „Â·ë‹¤ìŒ)ë¥¼ í•œ ì¤„ë¡œ ì •ë ¬
  if (selectionCard && selectionRight && longTextGuideToggleBtn && longTextPageControls) {
    if (tab === "longtext") {
      // ê¸´ ê¸€ ëª¨ë“œ: íˆ´ë°” êµ¬ì„± ìš”ì†Œë“¤ì„ selection-right ì•ˆìœ¼ë¡œ ëª¨ìœ¼ê³ , ê°€ë¡œ ë°°ì¹˜
      selectionCard.classList.add("longtext-toolbar");
      selectionRight.appendChild(longTextGuideToggleBtn);
      selectionRight.appendChild(longTextPageControls);
    } else {
      // ë‹¤ë¥¸ íƒ­: ì›ë˜ êµ¬ì¡°ë¡œ ë³µê·€
      selectionCard.classList.remove("longtext-toolbar");
      selectionCard.appendChild(longTextGuideToggleBtn);
      selectionCard.appendChild(longTextPageControls);
    }
  }



          // ê¸´ ê¸€ íƒ­ì¼ ë•ŒëŠ” selection-card ë ˆì´ì•„ì›ƒì„ ì„¸ë¡œë¡œ ì „í™˜
  if (selectionCard) {
    if (tab === "longtext") {
      selectionCard.classList.add("longtext-mode");
    } else {
      selectionCard.classList.remove("longtext-mode");
    }
  }


  // ğŸ”¹ ê¸´ ê¸€ íƒ­ì¼ ë•Œ: í•„ì‚¬ ëª¨ë“œ
  if (traceCard && freeCard) {
    const traceHeader = traceCard.querySelector(".canvas-header");
    const traceWrap = traceCard.querySelector(".canvas-wrap");
    const freeHeader = freeCard.querySelector(".canvas-header");
    const freeWrap = freeCard.querySelector(".canvas-wrap");
    const freeBottom = freeCard.querySelector(".bottom-bar");

    if (tab === "longtext") {
  // ìœ„ ì¹´ë“œ: í•„ì‚¬ (ë¬¸êµ¬ëŠ” ê·¸ëŒ€ë¡œ ì‚¬ìš©)
  if (traceHeader) {
    const spans = traceHeader.querySelectorAll("span");
    if (spans[0]) spans[0].textContent = "í•„ì‚¬";
    if (spans[1]) spans[1].textContent = "ìœ„ì˜ ê¸´ ê¸€ì„ ë³´ê³  ê·¸ëŒ€ë¡œ ì¨ ë³´ì„¸ìš”.";
  }

  // ğŸ”¹ í•„ì‚¬ ì¹¸ ë†’ì´ë¥¼ ë‹¤ë¥¸ íƒ­ê³¼ ë™ì¼í•˜ê²Œ 220pxë¡œ ë§ì¶”ê¸°
  if (traceWrap) {
    traceWrap.style.display = "block";
    traceWrap.style.height = "320px";   // ììŒ/ë‹¨ì–´ íƒ­ê³¼ ê°™ì€ ë†’ì´
  }

  // ë ˆì´ì•„ì›ƒë„ ë‹¤ë¥¸ íƒ­ê³¼ ë™ì¼í•˜ê²Œ (flex ì„¤ì • ì´ˆê¸°í™”)
  traceCard.style.flex = "";

  // ì•„ë˜ ì¹´ë“œ: ì§€ê¸ˆ êµ¬ì¡°ì²˜ëŸ¼ ìº”ë²„ìŠ¤ëŠ” ìˆ¨ê¸°ê³ , 'ëª¨ë‘ ì§€ìš°ê¸°'ë§Œ ë‚¨ê¸°ëŠ” í˜•íƒœ ìœ ì§€
  if (freeHeader) freeHeader.style.display = "none";
  if (freeWrap) freeWrap.style.display = "none";
  if (freeBottom) freeBottom.style.display = "flex";
  freeCard.style.flex = "0 0 auto"; // ë†’ì´ë¥¼ ìµœì†Œë¡œ ìœ ì§€

    } else {
      // ğŸ”¹ ììŒ / ëª¨ìŒ / ë‹¨ì–´ / ë¬¸ì¥ íƒ­: ë”°ë¼ì“°ê¸° + ì§ì ‘ì“°ê¸°, ë‘ ì¹¸ ëª¨ë‘ ê· í˜• ìˆê²Œ
      if (traceHeader) {
        const spans = traceHeader.querySelectorAll("span");
        if (spans[0]) spans[0].textContent = "1. ë”°ë¼ ì“°ê¸°";
        if (spans[1]) spans[1].textContent = "ì—°í•œ ê¸€ìë¥¼ ë”°ë¼ ê·¸ë ¤ ë³´ì„¸ìš”.";
      }

      if (traceWrap) {
        traceWrap.style.display = "block";
        traceWrap.style.height = "220px";  // ì§§ì€ íƒ­ìš© í•„ì‚¬ ì¹¸ ë†’ì´ (ì›í•˜ì‹œë©´ 200~260 ì‚¬ì´ë¡œ ì¡°ì ˆ)
      }

      if (freeHeader) freeHeader.style.display = "";
      if (freeWrap) {
        freeWrap.style.display = "block";
        freeWrap.style.height = "220px";   // ì§ì ‘ ì“°ê¸° ì¹¸ë„ ë™ì¼í•˜ê²Œ
      }
      if (freeBottom) freeBottom.style.display = "flex";

      traceCard.style.flex = "";
      freeCard.style.flex = "";
    }  // ğŸ”¹ íƒ­ì„ ë°”ê¿€ ë•ŒëŠ” ì˜¤ë¥¸ìª½ ì¹´ë“œì™€ ì—°í•œ ê¸€ìë¥¼ ì´ˆê¸°í™”
  currentSelection = null;
  renderSelectionInfo(null);
  updateTraceGuide("");
      
 if (traceCanvas && traceCtx && freeCanvas && freeCtx) {
      resizeCanvas(traceCanvas, traceCtx, true);
      resizeCanvas(freeCanvas, freeCtx, false);
    }
      
  }

  // ì„ íƒì´ ì•„ë¬´ê²ƒë„ ì—†ìœ¼ë©´ ì•ˆë‚´ ë¬¸êµ¬
  if (!currentSelection) {
    renderSelectionInfo(null);
  }
}


        


    tabButtons.forEach(btn => {
  btn.addEventListener("click", () => {
    const tab = btn.dataset.tab;
    setTab(tab);

    // ê¸´ ê¸€ íƒ­ì—ì„œë„ ì´ì œ ìŠ¤í¬ë¡¤/ë ˆì´ì•„ì›ƒì„ ë™ì¼í•˜ê²Œ ì‚¬ìš©í•˜ë¯€ë¡œ long-modeëŠ” ì“°ì§€ ì•ŠìŒ
    document.body.classList.remove("long-mode");
  });
});



    // ======================
    // ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
    // ======================
    function initLetters() {
      lettersList.innerHTML = "";
      consonants.forEach((letter) => {
        const div = document.createElement("div");
        div.className = "card";
        const ar = document.createElement("div");
        ar.className = "card-ar";
        ar.textContent = letter.char;

        const name = document.createElement("div");
        name.className = "card-name";
        name.textContent = letter.name;

        const sound = document.createElement("div");
        sound.className = "card-sound";
        sound.textContent = letter.sound;

        div.appendChild(ar);
        div.appendChild(name);
        div.appendChild(sound);

        div.addEventListener("click", () => {
          document.querySelectorAll("#lettersList .card").forEach(c => c.classList.remove("active"));
          div.classList.add("active");
          currentSelection = {
            type: "ììŒ",
            arabic: letter.char,
            meaning: letter.name,
            pron: letter.sound,
            forms: letter.forms || null
          };
          renderSelectionInfo(currentSelection);
            if (longTextGuideEnabled) {
    updateTraceGuide(letter.char);
  } else {
    updateTraceGuide("");
  }
        });

        lettersList.appendChild(div);
      });
    }

    function initVowels() {
      vowelsList.innerHTML = "";
      vowels.forEach((v) => {
        const div = document.createElement("div");
        div.className = "card";
        const ar = document.createElement("div");
        ar.className = "card-ar";
        ar.textContent = v.char;

        const name = document.createElement("div");
        name.className = "card-name";
        name.textContent = v.name;

        const sound = document.createElement("div");
        sound.className = "card-sound";
        sound.textContent = v.sound;

        div.appendChild(ar);
        div.appendChild(name);
        div.appendChild(sound);

        div.addEventListener("click", () => {
          document.querySelectorAll("#vowelsList .card").forEach(c => c.classList.remove("active"));
          div.classList.add("active");
          currentSelection = {
            type: "ëª¨ìŒ",
            arabic: v.char,
            meaning: v.name,
            pron: v.sound,
            forms: null
          };
          renderSelectionInfo(currentSelection);
          if (longTextGuideEnabled) {
  updateTraceGuide(v.char);
} else {
  updateTraceGuide("");
}
        });

        vowelsList.appendChild(div);
      });
    }

    let currentWordCategory = "colors";

    function setWordCategory(cat) {
      currentWordCategory = cat;
      document.querySelectorAll("button[data-wordcat]").forEach(btn => {
        btn.classList.toggle("active", btn.dataset.wordcat === cat);
      });
      renderWordList();
    }

    function renderWordList() {
      const list = wordCategories[currentWordCategory] || [];
      wordsList.innerHTML = "";
      list.forEach((w) => {
        const div = document.createElement("div");
        div.className = "card";
        const ar = document.createElement("div");
        ar.className = "card-ar";
        ar.textContent = w.arabic;

        const name = document.createElement("div");
        name.className = "card-name";
        name.textContent = w.meaning;

        const sound = document.createElement("div");
        sound.className = "card-sound";
        sound.textContent = w.pron;

        div.appendChild(ar);
        div.appendChild(name);
        div.appendChild(sound);

        div.addEventListener("click", () => {
          document.querySelectorAll("#wordsList .card").forEach(c => c.classList.remove("active"));
          div.classList.add("active");
          currentSelection = {
            type: "ë‹¨ì–´",
            arabic: w.arabic,
            meaning: w.meaning,
            pron: w.pron,
            forms: null
          };
          renderSelectionInfo(currentSelection);
          if (longTextGuideEnabled) {
  updateTraceGuide(w.arabic);
} else {
  updateTraceGuide("");
}
          speakArabic(w.arabic);
        });

        wordsList.appendChild(div);
      });
    }

    function initWordCategoryButtons() {
      document.querySelectorAll("button[data-wordcat]").forEach(btn => {
        btn.addEventListener("click", () => setWordCategory(btn.dataset.wordcat));
      });
      setWordCategory("colors");
    }

    function initSentences() {
      sentencesList.innerHTML = "";
      sentences.forEach((s, idx) => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.style.padding = "6px 8px";
        btn.style.fontSize = "0.8rem";
        btn.style.borderRadius = "10px";
        btn.style.border = "1px solid #e5e7eb";
        btn.style.background = "white";
        btn.style.cursor = "pointer";
        btn.style.textAlign = "left";
        btn.textContent = (idx + 1) + ". " + s.meaning;

        btn.addEventListener("click", () => {
          document.querySelectorAll("#sentencesList button").forEach(b => {
            b.style.borderColor = "#e5e7eb";
            b.style.background = "white";
          });
          btn.style.borderColor = "#f97316";
          btn.style.background = "#fff7ed";
          currentSelection = {
            type: "ë¬¸ì¥",
            arabic: s.arabic,
            meaning: s.meaning,
            pron: s.pron,
            forms: null
          };
          renderSelectionInfo(currentSelection);
          if (longTextGuideEnabled) {
  updateTraceGuide(s.arabic);
} else {
  updateTraceGuide("");
}

          speakArabic(s.arabic);
        });

        sentencesList.appendChild(btn);
      });
    }

        function initLongTexts() {
      renderLongTexts();
    }

    let currentLongLevel = "beginner";

    function renderLongTexts() {
      if (!longtextList) return;
      longtextList.innerHTML = "";

      const filtered = longTexts.filter(t => t.level === currentLongLevel);

      filtered.forEach(text => {
        const div = document.createElement("div");
        div.className = "longtext-item";
        div.dataset.id = text.id;

        const title = document.createElement("div");
        title.className = "longtext-item-title";
        title.textContent = text.title;

        const meta = document.createElement("div");
        meta.className = "longtext-item-meta";
        meta.textContent = text.tag || "";

        div.appendChild(title);
        div.appendChild(meta);

        div.addEventListener("click", () => {
          // active í‘œì‹œ
          longtextList.querySelectorAll(".longtext-item").forEach(i => i.classList.remove("active"));
          div.classList.add("active");

          // ì„ íƒ ì •ë³´ ì—…ë°ì´íŠ¸
          currentSelection = {
  type: "ê¸´ ê¸€",
  arabic: text.title,         // ì¹´ë“œ ìƒë‹¨ì—ëŠ” ì œëª©ë§Œ
  meaning: text.tag || "",
  pron: "",
  forms: null,
  longTextArabic: text.arabic,
  longTextKorean: text.korean,
  // ğŸ”¹ í•œêµ­ì–´ë„ ì¤„ ë‹¨ìœ„ë¡œ ìª¼ê°œì„œ ì €ì¥
  longTextKoreanSentences: (text.korean || "")
    .split("\n")
    .map(s => s.trim())
    .filter(s => s.length > 0)
};

renderSelectionInfo(currentSelection);


         // ğŸ”¹ ê¸´ ê¸€: ì—°í•œ ì•„ëì–´ ON/OFF ìƒíƒœì— ë”°ë¼ ê°€ì´ë“œ ì ìš©
      if (longTextGuideEnabled) {
        // ğŸ”¹ ê¸´ ê¸€: í˜ì´ì§€ ë‹¨ìœ„ë¡œ ì¤€ë¹„ (í•œ ë²ˆì— 3ë¬¸ì¥ì”©)
        prepareLongTextPages(text.arabic);
      } else {
        // ğŸ”¹ ì—°í•œ ì•„ëì–´ OFFì¼ ë•Œ: ê°€ì´ë“œ/í˜ì´ì§€ ì •ë³´ ì´ˆê¸°í™”
        updateTraceGuide("");
        longTextSentences = [];
        longTextPageIndex = 0;
        updateLongTextPageControls();
      }



        });

        longtextList.appendChild(div);
      });
    }

      // ğŸ”¹ ê¸´ ê¸€ ì•„ëì–´ ë³¸ë¬¸ì„ ì¤„ ë‹¨ìœ„ë¡œ ìª¼ê°œê³ , ì²« í˜ì´ì§€ë¡œ ì´ˆê¸°í™”
function prepareLongTextPages(arabicText) {
  longTextSentences = (arabicText || "")
    .split("\n")
    .map(s => s.trim())
    .filter(s => s.length > 0);
  longTextPageIndex = 0;
  updateLongTextGuidePage();
  updateLongTextPageControls();
}

// ğŸ”¹ í˜„ì¬ í˜ì´ì§€ì— í•´ë‹¹í•˜ëŠ” 3ë¬¸ì¥ë§Œ ì—°í•œ ê¸€ìë¡œ ê·¸ë¦¬ê¸°
function updateLongTextGuidePage() {
  if (!currentSelection || !currentSelection.longTextArabic) return;

  const start = longTextPageIndex * LONG_TEXT_PAGE_SIZE;

  const arPage = longTextSentences.slice(start, start + LONG_TEXT_PAGE_SIZE);
  const krPage = currentSelection.longTextKoreanSentences
    ? currentSelection.longTextKoreanSentences.slice(start, start + LONG_TEXT_PAGE_SIZE)
    : [];

  // ì•„ëì–´ (ìœ„ìª½) â€“ ë¬¸ì¥ë“¤ì„ í•œ ë©ì–´ë¦¬ë¡œ ì´ì–´ ë¶™ì´ê¸°
  const arBody = document.getElementById("lt-ar-body");
  if (arBody) {
    if (longTextGuideEnabled) {
      const arText = arPage.join(" ");   // ë¬¸ì¥ ì‚¬ì´ë¥¼ ê³µë°±ìœ¼ë¡œ ì´ì–´ì„œ í•˜ë‚˜ì˜ ë¬¸ë‹¨ìœ¼ë¡œ
      arBody.textContent = arText;
    } else {
      arBody.textContent = "";
    }
  }

  // í•œêµ­ì–´ (ì•„ë˜ìª½) â€“ ë§ˆì°¬ê°€ì§€ë¡œ í•œ ë©ì–´ë¦¬ë¡œ
  const krBody = document.getElementById("lt-kr-body");
  if (krBody) {
    const krText = krPage.join(" ");
    krBody.textContent = krText;
  }
      // ğŸ”¹ í•„ì‚¬ ì¹¸ìš© ì—°í•œ ì•„ëì–´ ê°€ì´ë“œ: ë¬¸ì¥ë§ˆë‹¤ ì¤„ë°”ê¿ˆí•´ì„œ ìº”ë²„ìŠ¤ì— í‘œì‹œ
  if (longTextGuideEnabled) {
    const guideText = arPage.join("\n");   // ë¬¸ì¥ ì‚¬ì´ë¥¼ ì¤„ë°”ê¿ˆìœ¼ë¡œ ì—°ê²°
    updateTraceGuide(guideText);
  } else {
    updateTraceGuide("");
  }

  updateLongTextPageControls();
}




// ğŸ”¹ í˜ì´ì§€ ë²ˆí˜¸ / ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ê°±ì‹ 
function updateLongTextPageControls() {
  if (!longTextPageControls) return;

  // ê¸´ ê¸€ íƒ­ì´ ì•„ë‹ˆê±°ë‚˜, ë¬¸ì¥ì´ ì—†ìœ¼ë©´ ìˆ¨ê¹€
  if (currentTab !== "longtext" || !longTextSentences.length) {
    longTextPageControls.style.display = "none";
    return;
  }

  const totalPages = Math.ceil(longTextSentences.length / LONG_TEXT_PAGE_SIZE);
  if (totalPages <= 1) {
    longTextPageControls.style.display = "none";
    return;
  }

  longTextPageControls.style.display = "inline-flex";
  longTextPageInfo.textContent = `${longTextPageIndex + 1} / ${totalPages}`;
  longTextPrevBtn.disabled = (longTextPageIndex === 0);
  longTextNextBtn.disabled = (longTextPageIndex >= totalPages - 1);
}


    
// ======================
// ì„ íƒ ì •ë³´ ì¹´ë“œ ë Œë”ë§
// ======================
function renderSelectionInfo(sel) {
  if (!sel) {
    selArabic.textContent = "ì•„ëì–´ ì—°ìŠµ ì‚¬ì´íŠ¸";
    selType.textContent = "ì•ˆë‚´";
    selExtra.innerHTML =
      "<span>ì™¼ìª½ì—ì„œ ììŒÂ·ëª¨ìŒÂ·ë‹¨ì–´Â·ë¬¸ì¥ì„ ì„ íƒí•˜ë©´ ì´ê³³ì— ì •ë³´ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</span>";
    selForms.classList.add("hidden");
    playSelectionBtn.style.display = "inline-flex";
    if (longTextGuideToggleBtn) {
      longTextGuideToggleBtn.style.display = "none";
    }
    return;
  }

  selArabic.textContent = sel.arabic;
  selType.textContent = sel.type;

  const extraParts = [];
  if (sel.meaning) {
    extraParts.push(`<span>ëœ»: ${sel.meaning}</span>`);
  }
  if (sel.pron) {
    extraParts.push(`<span>ë°œìŒ: ${sel.pron}</span>`);
  }
// ğŸ”¹ ê¸´ ê¸€ì¸ ê²½ìš°: ìƒë‹¨ êµ¬ì¡° ì¬ì •ì˜ (ìœ„: ì•„ëì–´ / ì•„ë˜: í•œêµ­ì–´)
if (sel.longTextArabic) {
  // íƒœê·¸(ì˜ˆ: "ì¼ìƒ ë™í™” Â· ì´ˆê¸‰")
  let tagHtml = "";
  if (sel.meaning) {
    tagHtml = `
      <div class="longtext-tag">
        ${sel.meaning}
      </div>
    `;
  }

  // ë¼ë²¨ ë°•ìŠ¤ ì—†ì´, ë³¸ë¬¸ë§Œ ìœ„ì•„ë˜ë¡œ ë°°ì¹˜
  selExtra.innerHTML = `
    ${tagHtml}

    <!-- ì•„ëì–´ ë³¸ë¬¸ (ìœ„ìª½) -->
    <div id="lt-ar-body" class="longtext-block-body ar"></div>

    <!-- í•œêµ­ì–´ ë³¸ë¬¸ (ì•„ë˜ìª½) -->
    <div id="lt-kr-body" class="longtext-block-body" style="margin-top: 10px;"></div>
  `;

  // ì—°í•œ ì•„ëì–´ on/off ë²„íŠ¼ í‘œì‹œ
  if (longTextGuideToggleBtn) {
    longTextGuideToggleBtn.style.display = "inline-flex";
    longTextGuideToggleBtn.textContent = longTextGuideEnabled
      ? "ì—°í•œ ì•„ëì–´: ì¼œì§"
      : "ì—°í•œ ì•„ëì–´: êº¼ì§";
  }

  return;
}


  

      // ì—°í•œ ì•„ëì–´ on/off ë²„íŠ¼ í‘œì‹œ
  if (longTextGuideToggleBtn) {
    longTextGuideToggleBtn.style.display = "inline-flex";
    longTextGuideToggleBtn.textContent = longTextGuideEnabled
      ? "ì—°í•œ ì•„ëì–´: ì¼œì§"
      : "ì—°í•œ ì•„ëì–´: êº¼ì§";
  }

  return;
}



        function selectFormVariant(which) {
      if (!currentSelection || !currentSelection.forms) return;
      const formText = currentSelection.forms[which];
      if (!formText) return;

      // ì„ íƒí•œ í˜•íƒœë¡œ ë”°ë¼ì“°ê¸° ê°€ì´ë“œ ë³€ê²½
     if (longTextGuideEnabled) {
    updateTraceGuide(formText);
  } else {
    updateTraceGuide("");
  }

      // ì„ íƒí•œ í˜•íƒœ ë°œìŒë„ ë“£ê³  ì‹¶ìœ¼ë©´ ìœ ì§€
      speakArabic(formText);
    }


    // ======================
    // TTS (ë°œìŒ) - ì•„ëì–´ ë³´ì´ìŠ¤ ìš°ì„ 
    // ======================
    let availableVoices = [];
    function loadVoices() {
      availableVoices = window.speechSynthesis ? speechSynthesis.getVoices() : [];
    }
    if (window.speechSynthesis) {
      loadVoices();
      window.speechSynthesis.onvoiceschanged = loadVoices;
    }

    function speakArabic(text) {
      if (!window.speechSynthesis || !text) return;
      const utter = new SpeechSynthesisUtterance(text);

      // ì•„ëì–´ ë³´ì´ìŠ¤ ìš°ì„  ì„ íƒ
      let arVoices = availableVoices.filter(v => v.lang && v.lang.toLowerCase().startsWith("ar"));
      if (arVoices.length > 0) {
        utter.voice = arVoices[0];
        utter.lang = arVoices[0].lang;
      } else {
        // í´ë°±: ì•„ëì–´ ì½”ë“œë§Œ ì§€ì • (ë¸Œë¼ìš°ì €ê°€ ì•Œì•„ì„œ ì„ íƒ)
        utter.lang = "ar-SA";
      }

      // ë§í•˜ê¸° ì†ë„/í†¤ íŠœë‹ (ì¡°ê¸ˆ ì²œì²œíˆ, ë˜ë ·í•˜ê²Œ)
      utter.rate = 0.9;
      utter.pitch = 1.0;

      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(utter);
    }

  playSelectionBtn.addEventListener("click", () => {
  if (!currentSelection) return;
  // ììŒ/ëª¨ìŒì€ ë°œìŒ ë²„íŠ¼ ì‚¬ìš© ì•ˆ í•¨
  if (currentSelection.type === "ììŒ" || currentSelection.type === "ëª¨ìŒ") return;

  let textToSpeak = currentSelection.arabic;

  // ğŸ”¹ ê¸´ ê¸€ íƒ­ì¼ ë•Œ: í˜„ì¬ í˜ì´ì§€ì˜ 3ë¬¸ì¥ë§Œ ì½ê¸°
  if (currentSelection.type === "ê¸´ ê¸€") {
    if (longTextGuideEnabled && longTextSentences.length) {
      const start = longTextPageIndex * LONG_TEXT_PAGE_SIZE;
      textToSpeak = longTextSentences
        .slice(start, start + LONG_TEXT_PAGE_SIZE)
        .join("\n");
    } else if (currentSelection.longTextArabic) {
      // ì—°í•œ ê¸€ì OFF ìƒíƒœê±°ë‚˜ í˜ì´ì§€ ì •ë³´ê°€ ì—†ìœ¼ë©´ ì „ì²´ ë³¸ë¬¸
      textToSpeak = currentSelection.longTextArabic;
    }
  }

  speakArabic(textToSpeak);
});




    // ======================
    // ìº”ë²„ìŠ¤ ì´ˆê¸°í™” ë° ê·¸ë¦¬ê¸°
    // ======================
    function resizeCanvas(canvas, ctx, keepGuide) {
      const rect = canvas.getBoundingClientRect();
      const ratio = window.devicePixelRatio || 1;
      canvas.width = rect.width * ratio;
      canvas.height = rect.height * ratio;
      ctx.setTransform(ratio, 0, 0, ratio, 0, 0);
      ctx.lineCap = "round";
      ctx.lineJoin = "round";
      ctx.lineWidth = 4;
      ctx.strokeStyle = "#111827";

      if (keepGuide) {
        drawTraceGuide();
      }
    }

    function initCanvases() {
      traceCtx = traceCanvas.getContext("2d");
      freeCtx = freeCanvas.getContext("2d");
      resizeCanvas(traceCanvas, traceCtx, true);
      resizeCanvas(freeCanvas, freeCtx, false);

      // ë”°ë¼ì“°ê¸° ìº”ë²„ìŠ¤ ê·¸ë¦¬ê¸°
      initDrawing(traceCanvas, traceCtx, () => { traceDrawing = true; }, () => { traceDrawing = false; });
      // ì§ì ‘ ì“°ê¸° ìº”ë²„ìŠ¤ ê·¸ë¦¬ê¸°
      initDrawing(freeCanvas, freeCtx, () => { freeDrawing = true; }, () => { freeDrawing = false; });

      window.addEventListener("resize", () => {
        resizeCanvas(traceCanvas, traceCtx, true);
        resizeCanvas(freeCanvas, freeCtx, false);
      });
    }

    function initDrawing(canvas, ctx, onStart, onEnd) {
      let drawing = false;

      function getPos(e) {
        const rect = canvas.getBoundingClientRect();
        const x = (e.clientX - rect.left);
        const y = (e.clientY - rect.top);
        return { x, y };
      }

      canvas.addEventListener("pointerdown", (e) => {
        e.preventDefault();
        drawing = true;
        onStart();
        const { x, y } = getPos(e);
        ctx.beginPath();
        ctx.moveTo(x, y);
      });

      canvas.addEventListener("pointermove", (e) => {
        if (!drawing) return;
        e.preventDefault();
        const { x, y } = getPos(e);
        ctx.lineTo(x, y);
        ctx.stroke();
      });

      const stop = (e) => {
        if (!drawing) return;
        drawing = false;
        onEnd();
      };
      canvas.addEventListener("pointerup", stop);
      canvas.addEventListener("pointerleave", stop);
      window.addEventListener("pointerup", stop);
    }

    // ë”°ë¼ì“°ê¸° ê°€ì´ë“œ í…ìŠ¤íŠ¸
    // ë”°ë¼ì“°ê¸° ê°€ì´ë“œ í…ìŠ¤íŠ¸
function updateTraceGuide(text) {
  // 1) ìƒˆë¡œìš´ ê°€ì´ë“œ í…ìŠ¤íŠ¸ ì„¤ì •
  traceGuideText = text || "";

  // 2) ë”°ë¼ì“°ê¸° ìº”ë²„ìŠ¤ ì „ì²´ë¥¼ ì§€ìš°ê³ , ì—°í•œ ê¸€ìë¡œ ê°€ì´ë“œ ë‹¤ì‹œ ê·¸ë¦¼
  drawTraceGuide();

  // 3) ì§ì ‘ ì“°ê¸° ìº”ë²„ìŠ¤ë„ ê°™ì´ ì´ˆê¸°í™” (ì‚¬ìš©ìê°€ ì“´ ê¸€ì”¨ë§Œ ì§€ì›€)
  if (freeCtx && freeCanvas) {
    freeCtx.clearRect(0, 0, freeCanvas.width, freeCanvas.height);
  }
}


    function drawTraceGuide() {
  if (!traceCtx || !traceCanvas) return;

  const canvas = traceCanvas;
  const ctx = traceCtx;

  // ìº”ë²„ìŠ¤ ì „ì²´ ì§€ìš°ê¸°
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  if (!traceGuideText) return;

  ctx.save();
  ctx.globalAlpha = 0.12;
  ctx.fillStyle = "#9ca3af";
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";
  ctx.direction = "rtl";

  // ë””ë°”ì´ìŠ¤ í”½ì…€ ë¹„ìœ¨ ê³ ë ¤í•´ì„œ "í™”ë©´ ê¸°ì¤€ í¬ê¸°"ë¡œ ê³„ì‚°
  const ratio = window.devicePixelRatio || 1;
  const cw = canvas.width / ratio;   // í™”ë©´ ê¸°ì¤€ ê°€ë¡œ
  const ch = canvas.height / ratio;  // í™”ë©´ ê¸°ì¤€ ì„¸ë¡œ

  // ì—¬ëŸ¬ ì¤„/í•œ ì¤„ ì²˜ë¦¬
  const rawLines = (traceGuideText || "").split("\n");
  let lines = rawLines.map(l => l.trim()).filter(l => l.length > 0);
  if (lines.length === 0) {
    ctx.restore();
    return;
  }

  const isLong = (currentTab === "longtext");

  // ğŸ”¹ 1) ììŒ/ëª¨ìŒ/ë‹¨ì–´/ë¬¸ì¥ íƒ­: "í•œ ì¤„" í¬ê²Œ, ìº”ë²„ìŠ¤ì— ë”± ë§ê²Œ
  if (!isLong) {
    const text = lines[0];   // í•œ ì¤„ë§Œ ì‚¬ìš©
    let fontSize = Math.min(cw, ch) * 0.7;  // ê½‰ ì°¨ê²Œ ì‹œì‘

    // ìº”ë²„ìŠ¤ ì•ˆì— ë“¤ì–´ê°ˆ ë•Œê¹Œì§€ ì¤„ì´ê¸°
    while (fontSize > 10) {
      ctx.font = `${fontSize}px "Scheherazade New", "Noto Naskh Arabic", system-ui, sans-serif`;
      const w = ctx.measureText(text).width;
      const h = fontSize; // ëŒ€ëµ í•œ ì¤„ ë†’ì´ë¡œ ì‚¬ìš©

      const fitsWidth  = w <= cw * 0.9;  // ì¢Œìš° 10% ì—¬ë°±
      const fitsHeight = h <= ch * 0.8;  // ìœ„ì•„ë˜ 20% ì—¬ë°±

      if (fitsWidth && fitsHeight) break;
      fontSize *= 0.9;
    }

    ctx.font = `${fontSize}px "Scheherazade New", "Noto Naskh Arabic", system-ui, sans-serif`;

    // í™”ë©´ ê¸°ì¤€ ì¢Œí‘œë¡œ ê·¸ë¦¬ê¸° (resizeCanvasì—ì„œ ì´ë¯¸ ratioë¡œ ìŠ¤ì¼€ì¼í•¨)
    const x = cw / 2;
    const y = ch / 2;
    ctx.fillText(text, x, y);

    ctx.restore();
    return;
  }

  // ğŸ”¹ 2) ê¸´ ê¸€ íƒ­: ì—¬ëŸ¬ ì¤„ì´ ìº”ë²„ìŠ¤ ì•ˆì— ë“¤ì–´ê°€ë„ë¡ ìë™ ì¡°ì •
  let fontSize = Math.min(cw, ch) * 0.33;
  if (fontSize > 60) fontSize = 60;
  if (fontSize < 14) fontSize = 22;

  while (fontSize > 10) {
    ctx.font = `${fontSize}px "Scheherazade New", "Noto Naskh Arabic", system-ui, sans-serif`;

    let maxLineWidth = 0;
    for (const line of lines) {
      const w = ctx.measureText(line).width;
      if (w > maxLineWidth) maxLineWidth = w;
    }

    const lineHeight = fontSize * 1.6;
    const totalHeight = lineHeight * (lines.length - 1);

    const fitsWidth  = maxLineWidth <= cw * 0.9;  // ì¢Œìš° 10% ì—¬ë°±
    const fitsHeight = totalHeight  <= ch * 0.8;  // ìœ„ì•„ë˜ 20% ì—¬ë°±

    if (fitsWidth && fitsHeight) break;
    fontSize *= 0.9;
  }

  ctx.font = `${fontSize}px "Scheherazade New", "Noto Naskh Arabic", system-ui, sans-serif`;
  const lineHeightFinal = fontSize * 1.6;
  const totalHeightFinal = lineHeightFinal * (lines.length - 1);
  const centerY = ch / 2;

  lines.forEach((line, idx) => {
    const y = centerY - totalHeightFinal / 2 + idx * lineHeightFinal;
    ctx.fillText(line, cw / 2, y);
  });

  ctx.restore();
}





    // ì§€ìš°ê¸° ë²„íŠ¼: ìœ ì €ê°€ ê·¸ë¦° ë¶€ë¶„ë§Œ ì‚­ì œ, ê°€ì´ë“œëŠ” ë‹¤ì‹œ ê·¸ë¦¼
    clearBtn.addEventListener("click", () => {
      // ë”°ë¼ì“°ê¸° ìº”ë²„ìŠ¤: ì „ì²´ ì§€ìš°ê³  ê°€ì´ë“œ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
      drawTraceGuide();
      // ì§ì ‘ ì“°ê¸° ìº”ë²„ìŠ¤: ì „ì²´ í´ë¦¬ì–´
      freeCtx.clearRect(0, 0, freeCanvas.width, freeCanvas.height);
    });

        // ======================
    // ë…¹ìŒ ê¸°ëŠ¥ (MediaRecorder)
    // ======================
    let mediaRecorder = null;
    let recordedChunks = [];
    let recordedAudioUrl = null;
    let playbackAudio = null;

        function setRecordUi(state) {
      // state: 'idle' | 'recording' | 'ready'
      if (!recordStartBtn || !recordStopBtn || !recordPlayBtn || !recordStatus) return;

      if (state === "recording") {
        recordStartBtn.disabled = true;
        recordStopBtn.disabled = false;
        recordPlayBtn.disabled = true;
        // ì¬ìƒ ë²„íŠ¼ì€ ì•„ì§ ì‚¬ìš© ë¶ˆê°€ + ê¸°ë³¸ í…ìŠ¤íŠ¸ë¡œ ìœ ì§€
        recordPlayBtn.textContent = "â–¶ ì¬ìƒ";
        recordStatus.textContent = "ë…¹ìŒ ì¤‘â€¦ ì½ê³  ì‹¶ì€ ë¬¸ì¥ì„ ë§í•´ ë³´ì„¸ìš”.";
      } else if (state === "ready") {
        recordStartBtn.disabled = false;
        recordStopBtn.disabled = true;
        recordPlayBtn.disabled = false;
        // ë…¹ìŒì€ ëë‚¬ê³ , ì¬ìƒ ëŒ€ê¸° ìƒíƒœì´ë¯€ë¡œ â–¶ ì¬ìƒìœ¼ë¡œ ëŒë ¤ë‘ê¸°
        recordPlayBtn.textContent = "â–¶ ì¬ìƒ";
        recordStatus.textContent = "ë…¹ìŒ ì™„ë£Œ! ì¬ìƒ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë“¤ì–´ë³´ì„¸ìš”.";
      } else {
        // idle
        recordStartBtn.disabled = false;
        recordStopBtn.disabled = true;
        recordPlayBtn.disabled = true;
        recordPlayBtn.textContent = "â–¶ ì¬ìƒ";
        recordStatus.textContent = "ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤.";
      }
    }


    async function startRecording() {
      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        alert("ì´ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ë…¹ìŒ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        return;
      }
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        recordedChunks = [];
        mediaRecorder = new MediaRecorder(stream);

        mediaRecorder.ondataavailable = (e) => {
          if (e.data && e.data.size > 0) {
            recordedChunks.push(e.data);
          }
        };

        mediaRecorder.onstop = () => {
          const blob = new Blob(recordedChunks, { type: "audio/webm" });
          if (recordedAudioUrl) {
            URL.revokeObjectURL(recordedAudioUrl);
          }
          recordedAudioUrl = URL.createObjectURL(blob);
          setRecordUi("ready");
        };

        mediaRecorder.start();
        setRecordUi("recording");
      } catch (err) {
        console.error(err);
        alert("ë§ˆì´í¬ ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ë§ˆì´í¬ ê¶Œí•œì„ í—ˆìš©í•´ ì£¼ì„¸ìš”.");
      }
    }

    function stopRecording() {
      if (mediaRecorder && mediaRecorder.state === "recording") {
        mediaRecorder.stop();
      }
    }

            function playRecording() {
      if (!recordedAudioUrl) return;

      // ì´ë¯¸ ì¬ìƒ ì¤‘ì´ë©´ â†’ ë©ˆì¶”ê³ , ë²„íŠ¼ í…ìŠ¤íŠ¸ë¥¼ ë‹¤ì‹œ "â–¶ ì¬ìƒ"ìœ¼ë¡œ
      if (playbackAudio) {
        playbackAudio.pause();
        playbackAudio.currentTime = 0;
        playbackAudio = null;
        recordPlayBtn.textContent = "â–¶ ì¬ìƒ";
        recordStatus.textContent = "ì¬ìƒì„ ë©ˆì·„ìŠµë‹ˆë‹¤.";
        return;
      }

      // ìƒˆë¡œ ì¬ìƒ ì‹œì‘
      playbackAudio = new Audio(recordedAudioUrl);
      playbackAudio.onended = () => {
        playbackAudio = null;
        // ì¬ìƒì´ ìì—°ìŠ¤ëŸ½ê²Œ ëë‚¬ì„ ë•Œë„ ë²„íŠ¼ì„ ë‹¤ì‹œ â–¶ ì¬ìƒìœ¼ë¡œ
        recordPlayBtn.textContent = "â–¶ ì¬ìƒ";
        recordStatus.textContent = "ì¬ìƒì´ ëë‚¬ìŠµë‹ˆë‹¤.";
      };

      playbackAudio.play();
      // ì¬ìƒ ì‹œì‘ ì‹œ ë²„íŠ¼ì„ â¹ ë©ˆì¶¤ìœ¼ë¡œ ë³€ê²½
      recordPlayBtn.textContent = "â¹ ë©ˆì¶¤";
      recordStatus.textContent = "ë…¹ìŒëœ ì†Œë¦¬ë¥¼ ì¬ìƒ ì¤‘ì…ë‹ˆë‹¤.";
    }



    // ë…¹ìŒ ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²°
    if (recordStartBtn && recordStopBtn && recordPlayBtn) {
      setRecordUi("idle");
      recordStartBtn.addEventListener("click", startRecording);
      recordStopBtn.addEventListener("click", stopRecording);
      recordPlayBtn.addEventListener("click", playRecording);
    }

// ======================
// ê¸´ ê¸€ íƒ­: í˜ì´ì§€ ë„˜ê¸°ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸
// ======================
if (longTextPrevBtn) {
  longTextPrevBtn.addEventListener("click", () => {
    if (longTextPageIndex > 0) {
      longTextPageIndex--;
      updateLongTextGuidePage();
      updateLongTextPageControls();
    }
  });
}

if (longTextNextBtn) {
  longTextNextBtn.addEventListener("click", () => {
    const totalPages = Math.ceil(longTextSentences.length / LONG_TEXT_PAGE_SIZE);
    if (longTextPageIndex < totalPages - 1) {
      longTextPageIndex++;
      updateLongTextGuidePage();
      updateLongTextPageControls();
    }
  });
}


      
    // ======================
    // ì´ˆê¸° ì‹¤í–‰
    // ======================
    initLetters();
    initVowels();
    initWordCategoryButtons();
    renderWordList();
    initSentences();
    initCanvases();
    initLongTexts();
    renderSelectionInfo(null);
  </script>
</body>
</html>
